

<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MotoT√°xi Tapau√° - Conectando voc√™ ao seu destino</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <!-- Chart.js para gr√°ficos -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#000000',
            secondary: '#00D4AA',
            accent: '#FFB800'
          }
        }
      }
    }
  </script>
</head>
<body class="bg-gray-50 min-h-screen">
  <!-- Header -->
  <header class="bg-white shadow-sm border-b sticky top-0 z-40">
    <div class="container mx-auto px-4 py-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <div class="bg-primary text-white p-2 rounded-lg">
            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 2L13.09 8.26L22 9L13.09 9.74L12 16L10.91 9.74L2 9L10.91 8.26L12 2Z"/>
            </svg>
          </div>
          <div>
            <h1 class="text-xl font-bold text-gray-900">MotoT√°xi Tapau√°</h1>
            <p class="text-sm text-gray-500">Conectando voc√™ ao seu destino</p>
            <p id="status-dispositivo" class="text-xs text-yellow-600">üü° Conectando...</p>
          </div>
        </div>
        <div class="flex items-center gap-3">
          <!-- Indicador de Notifica√ß√µes -->
          <div id="notification-badge" class="relative">
            <svg class="w-6 h-6 text-red-500" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 19V20H3V19L5 17V11C5 7.9 7 5.2 10 4.3V4C10 2.9 10.9 2 12 2S14 2.9 14 4V4.3C17 5.2 19 7.9 19 11V17L21 19ZM12 22C10.9 22 10 21.1 10 20H14C14 21.1 13.1 22 12 22Z"/>
            </svg>
            <span id="badge-count" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold hidden">0</span>
          </div>
          
          <div class="flex gap-2">
            <button id="btn-passageiro" onclick="mostrarInterface('passageiro')" 
                    class="px-4 py-2 bg-primary text-white rounded-lg font-medium transition-all hover:bg-gray-800">
              Passageiro
            </button>
            <button id="btn-motorista" onclick="mostrarInterface('motorista')" 
                    class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg font-medium transition-all hover:bg-gray-50">
              Motorista
            </button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Interface do Passageiro -->
  <div id="interface-passageiro" class="container mx-auto px-4 py-8 max-w-md">
    <!-- Solicitar Corrida -->
    <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
      <div class="text-center mb-6">
        <div class="bg-secondary/10 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
          <svg class="w-10 h-10 text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
          </svg>
        </div>
        <h2 class="text-2xl font-bold text-gray-900 mb-2">Para onde vamos?</h2>
        <p class="text-gray-600">Solicite sua corrida agora</p>
      </div>

      <div class="space-y-4 mb-6">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">üìç Origem</label>
          <div class="relative">
            <input type="text" id="origem" placeholder="Digite o local de partida ou use GPS" 
                   class="w-full px-4 py-3 pr-12 border border-gray-300 rounded-xl focus:ring-2 focus:ring-secondary focus:border-transparent">
            <button onclick="obterLocalizacao('origem')" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-secondary hover:text-secondary/80">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
              </svg>
            </button>
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">üéØ Destino</label>
          <input type="text" id="destino" placeholder="Para onde voc√™ quer ir?" 
                 class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-secondary focus:border-transparent">
        </div>

        <!-- Pre√ßo Fixo -->
        <div class="bg-green-50 p-4 rounded-xl border border-green-200">
          <div class="flex justify-between items-center">
            <div>
              <p class="text-sm text-gray-600">Tarifa Fixa</p>
              <p class="text-2xl font-bold text-green-600">R$ 5,00</p>
            </div>
            <div class="text-right">
              <p class="text-sm text-gray-600">Tempo estimado</p>
              <p class="text-lg font-bold text-gray-900">5-15 min</p>
            </div>
          </div>
        </div>
      </div>

      <button onclick="solicitarCorrida()" id="btn-solicitar" 
              class="w-full bg-secondary text-white py-4 rounded-xl font-bold text-lg hover:bg-secondary/90 transition-all transform hover:scale-105 shadow-lg">
        üöÄ Solicitar MotoT√°xi - R$ 5,00
      </button>
    </div>

    <!-- Status da Corrida -->
    <div id="status-corrida" class="bg-white rounded-2xl shadow-lg p-6 mb-6 hidden">
      <div class="text-center mb-4">
        <div id="status-icon" class="w-20 h-20 bg-accent/10 rounded-full flex items-center justify-center mx-auto mb-4">
          <div class="animate-spin">
            <svg class="w-10 h-10 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
            </svg>
          </div>
        </div>
        <h3 id="status-titulo" class="text-xl font-bold text-gray-900 mb-2">Procurando motorista...</h3>
        <p id="status-descricao" class="text-gray-600">Enviando solicita√ß√£o para todos os motoristas dispon√≠veis</p>
        <div id="contador-busca" class="mt-2">
          <p class="text-sm text-blue-600">‚è±Ô∏è Buscando h√° <span id="tempo-busca">0</span> segundos</p>
        </div>
      </div>

      <!-- Informa√ß√µes do Motorista -->
      <div id="info-motorista" class="border-t pt-4 hidden">
        <div class="flex items-center gap-4 mb-4">
          <div class="w-16 h-16 bg-gray-300 rounded-full flex items-center justify-center">
            <span class="text-2xl">üèçÔ∏è</span>
          </div>
          <div class="flex-1">
            <h4 id="nome-motorista" class="font-bold text-gray-900 text-lg">Jo√£o Silva</h4>
            <div class="flex items-center gap-1 mb-1">
              <span class="text-accent">‚≠ê</span>
              <span class="text-sm text-gray-600">4.8 (127 avalia√ß√µes)</span>
            </div>
            <p id="veiculo-motorista" class="text-sm text-gray-500">Moto-t√°xi ‚Ä¢ Tapau√°</p>
            <p class="text-sm font-medium text-green-600">‚úÖ Motorista a caminho</p>
          </div>
        </div>

        <!-- Tempo de Chegada -->
        <div class="bg-blue-50 p-4 rounded-lg mb-4">
          <div class="flex items-center justify-between mb-2">
            <span class="text-sm text-gray-600">Chegada em:</span>
            <span id="tempo-chegada" class="font-bold text-blue-600 text-lg">3 min</span>
          </div>
          <div class="w-full bg-blue-200 rounded-full h-3">
            <div id="progresso-chegada" class="bg-blue-600 h-3 rounded-full transition-all duration-1000" style="width: 0%"></div>
          </div>
        </div>

        <!-- Bot√µes de A√ß√£o -->
        <div class="flex gap-3">
          <button onclick="ligarMotorista()" class="flex-1 bg-green-500 text-white py-3 rounded-lg font-medium hover:bg-green-600 transition-all">
            üìû Ligar
          </button>
          <button onclick="abrirChatPassageiro()" class="flex-1 bg-blue-500 text-white py-3 rounded-lg font-medium hover:bg-blue-600 transition-all">
            üí¨ Chat
          </button>
          <button onclick="cancelarCorrida()" class="flex-1 bg-red-500 text-white py-3 rounded-lg font-medium hover:bg-red-600 transition-all">
            ‚ùå Cancelar
          </button>
        </div>
      </div>

      <!-- Corrida em Andamento -->
      <div id="corrida-em-andamento" class="border-t pt-4 hidden">
        <div class="bg-green-50 p-4 rounded-lg mb-4">
          <div class="text-center">
            <h4 class="font-bold text-green-700 mb-2">üèçÔ∏è Corrida em Andamento</h4>
            <p class="text-sm text-gray-600">Voc√™ est√° a caminho do destino</p>
            <p class="text-lg font-bold text-green-600 mt-2">R$ 5,00</p>
          </div>
        </div>
        
        <div class="flex gap-3">
          <button onclick="ligarMotorista()" class="flex-1 bg-green-500 text-white py-3 rounded-lg font-medium hover:bg-green-600 transition-all">
            üìû Ligar
          </button>
          <button onclick="abrirChatPassageiro()" class="flex-1 bg-blue-500 text-white py-3 rounded-lg font-medium hover:bg-blue-600 transition-all">
            üí¨ Chat
          </button>
        </div>
      </div>
    </div>

    <!-- Hist√≥rico de Corridas -->
    <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
      <h3 class="text-lg font-bold text-gray-900 mb-4">üìã Hist√≥rico de Corridas</h3>
      <div id="historico-passageiro" class="space-y-3">
        <p class="text-gray-500 text-center py-4">Nenhuma corrida realizada ainda</p>
      </div>
    </div>
  </div>

  <!-- Interface do Motorista -->
  <div id="interface-motorista" class="container mx-auto px-4 py-8 max-w-md hidden">
    <!-- Cadastro/Login do Motorista -->
    <div id="cadastro-motorista" class="bg-white rounded-2xl shadow-lg p-6 mb-6">
      <div class="text-center mb-6">
        <div class="bg-primary/10 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
          <svg class="w-10 h-10 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
          </svg>
        </div>
        <h2 class="text-2xl font-bold text-gray-900 mb-2">Cadastro de Motorista</h2>
        <p class="text-gray-600">Preencha seus dados para come√ßar</p>
      </div>

      <div class="space-y-4 mb-6">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Nome Completo</label>
          <input type="text" id="nome-motorista" placeholder="Digite seu nome completo" 
                 class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-secondary focus:border-transparent">
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">CPF</label>
          <input type="text" id="cpf-motorista" placeholder="000.000.000-00" maxlength="14"
                 class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-secondary focus:border-transparent">
          <p id="cpf-erro" class="text-red-500 text-sm mt-1 hidden">CPF inv√°lido</p>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Telefone</label>
          <input type="text" id="telefone-motorista" placeholder="(97) 99999-9999" 
                 class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-secondary focus:border-transparent">
        </div>
      </div>

      <button onclick="cadastrarMotorista()" id="btn-cadastrar" 
              class="w-full bg-secondary text-white py-4 rounded-xl font-bold text-lg hover:bg-secondary/90 transition-all">
        ‚úÖ Cadastrar-se
      </button>
    </div>

    <!-- Painel do Motorista -->
    <div id="painel-motorista" class="hidden">
      <!-- Boas-vindas do Motorista -->
      <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
        <div class="flex items-center justify-between mb-4">
          <div class="flex items-center gap-3">
            <div class="bg-secondary/10 w-12 h-12 rounded-full flex items-center justify-center">
              <svg class="w-6 h-6 text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
              </svg>
            </div>
            <div>
              <h3 class="text-lg font-bold text-gray-900">üëã Ol√°, <span class="nome-motorista-display text-secondary">Motorista</span>!</h3>
              <p class="text-gray-600 text-sm">Pronto para trabalhar</p>
            </div>
          </div>
          <button onclick="sairContaMotorista()" class="bg-gray-100 hover:bg-gray-200 text-gray-600 px-3 py-2 rounded-lg text-sm transition-all">
            üö™ Sair
          </button>
        </div>
      </div>

      <!-- Status do Motorista -->
      <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
        <div class="text-center mb-6">
          <div id="status-motorista-icon" class="bg-red-100 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
            <svg class="w-10 h-10 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728L5.636 5.636m12.728 12.728L18.364 5.636M5.636 18.364l12.728-12.728"/>
            </svg>
          </div>
          <h2 id="status-motorista-texto" class="text-2xl font-bold text-gray-900 mb-2">Offline</h2>
          <p class="text-gray-600">Toque para ficar dispon√≠vel para corridas</p>
        </div>

        <button onclick="alternarStatus()" id="btn-status" 
                class="w-full bg-green-500 text-white py-4 rounded-xl font-bold text-lg hover:bg-green-600 transition-all transform hover:scale-105 shadow-lg">
          üü¢ Ficar Online
        </button>
      </div>

      <!-- Pagamento do Aplicativo -->
      <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
        <div class="text-center mb-4">
          <div class="bg-accent/10 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
            <svg class="w-8 h-8 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"/>
            </svg>
          </div>
          <h3 class="text-lg font-bold text-gray-900 mb-2">üí≥ Pagar Aplicativo</h3>
          <p class="text-gray-600">Taxa di√°ria: R$ 5,00</p>
          <p id="status-pagamento" class="text-sm font-medium mt-2">
            <span class="text-red-500">‚ö†Ô∏è Pagamento em atraso: 2 dias</span>
          </p>
        </div>

        <div class="bg-gray-50 p-4 rounded-lg mb-4">
          <p class="text-sm text-gray-600 mb-2">C√≥digo PIX (Copie e cole no seu banco):</p>
          <div class="bg-white p-3 rounded border border-dashed border-gray-300">
            <p id="codigo-pix" class="text-xs font-mono break-all text-gray-800">
              00020126580014br.gov.bcb.pix013603383948269520400005303986540550.005802BR5925ADMINISTRADOR MOTOTAXI6007TAPAAUA62070503***6304
            </p>
          </div>
        </div>

        <div class="flex gap-3">
          <button onclick="copiarPix()" class="flex-1 bg-blue-500 text-white py-3 rounded-lg font-medium hover:bg-blue-600 transition-all">
            üìã Copiar PIX
          </button>
          <button onclick="confirmarPagamento()" class="flex-1 bg-green-500 text-white py-3 rounded-lg font-medium hover:bg-green-600 transition-all">
            ‚úÖ J√° Paguei
          </button>
        </div>
      </div>

      <!-- Nova Solicita√ß√£o de Corrida -->
      <div id="nova-solicitacao" class="bg-white rounded-2xl shadow-lg p-6 mb-6 hidden border-4 border-accent animate-pulse">
        <div class="text-center mb-4">
          <div class="bg-accent/20 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
            <svg class="w-10 h-10 text-accent animate-bounce" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
          </div>
          <h3 class="text-2xl font-bold text-gray-900 mb-2">üö® Nova Corrida!</h3>
          <p class="text-gray-600">Passageiro aguardando</p>
          <div class="bg-green-100 p-2 rounded-lg mt-2">
            <p class="text-lg font-bold text-green-700">üí∞ R$ 5,00 (Voc√™ ganha R$ 4,00)</p>
          </div>
        </div>

        <div class="space-y-3 mb-6">
          <div class="flex items-center gap-3">
            <span class="text-green-500 text-xl">üìç</span>
            <div>
              <p class="font-medium text-gray-900">Origem</p>
              <p id="origem-solicitacao" class="text-sm text-gray-600">Rua das Flores, 123 - Centro</p>
            </div>
          </div>
          <div class="flex items-center gap-3">
            <span class="text-red-500 text-xl">üéØ</span>
            <div>
              <p class="font-medium text-gray-900">Destino</p>
              <p id="destino-solicitacao" class="text-sm text-gray-600">Shopping Tapau√° - Zona Sul</p>
            </div>
          </div>
          <div class="flex items-center gap-3">
            <span class="text-blue-500 text-xl">üë§</span>
            <div>
              <p class="font-medium text-gray-900">Passageiro</p>
              <p id="nome-passageiro" class="text-sm text-gray-600">Cliente An√¥nimo</p>
            </div>
          </div>
        </div>

        <div class="flex gap-3 mb-4">
          <button onclick="recusarCorrida()" class="flex-1 bg-red-500 text-white py-4 rounded-xl font-bold hover:bg-red-600 transition-all">
            ‚ùå Recusar
          </button>
          <button onclick="aceitarCorrida()" class="flex-1 bg-green-500 text-white py-4 rounded-xl font-bold hover:bg-green-600 transition-all">
            ‚úÖ Aceitar Corrida
          </button>
        </div>
        
        <div class="text-center">
          <p class="text-sm text-gray-500">Tempo para responder: <span id="tempo-resposta" class="font-bold text-red-500">30s</span></p>
          <div class="w-full bg-red-200 rounded-full h-2 mt-2">
            <div id="barra-tempo" class="bg-red-500 h-2 rounded-full transition-all" style="width: 100%"></div>
          </div>
        </div>
      </div>

      <!-- Corrida Aceita -->
      <div id="corrida-aceita" class="bg-white rounded-2xl shadow-lg p-6 mb-6 hidden">
        <div class="text-center mb-4">
          <div class="bg-blue-100 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
            <svg class="w-10 h-10 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
            </svg>
          </div>
          <h3 class="text-xl font-bold text-gray-900 mb-2">üèçÔ∏è Corrida Aceita!</h3>
          <p class="text-gray-600">V√° at√© o local de origem</p>
          <div class="bg-green-100 p-2 rounded-lg mt-2">
            <p class="text-lg font-bold text-green-700">üí∞ R$ 5,00 (Voc√™ ganha R$ 4,00)</p>
          </div>
        </div>

        <div class="space-y-4 mb-6">
          <div class="bg-blue-50 p-4 rounded-lg">
            <h4 class="font-bold text-blue-700 mb-2">üìç Buscar Passageiro</h4>
            <p id="endereco-origem" class="text-sm text-gray-600">Rua das Flores, 123 - Centro</p>
          </div>
          
          <div class="bg-gray-50 p-4 rounded-lg">
            <h4 class="font-bold text-gray-700 mb-2">üéØ Destino Final</h4>
            <p id="endereco-destino" class="text-sm text-gray-600">Shopping Tapau√° - Zona Sul</p>
          </div>

          <div class="flex gap-3">
            <button onclick="ligarPassageiro()" class="flex-1 bg-green-500 text-white py-3 rounded-lg font-medium hover:bg-green-600 transition-all">
              üìû Ligar
            </button>
            <button onclick="abrirChatMotorista()" class="flex-1 bg-blue-500 text-white py-3 rounded-lg font-medium hover:bg-blue-600 transition-all">
              üí¨ Chat
            </button>
          </div>
        </div>

        <div class="space-y-3">
          <button onclick="iniciarCorrida()" id="btn-iniciar-corrida" class="w-full bg-accent text-white py-4 rounded-xl font-bold text-lg hover:bg-accent/90 transition-all">
            üöÄ Iniciar Corrida
          </button>
          <button onclick="finalizarCorrida()" id="btn-finalizar-corrida" class="w-full bg-green-500 text-white py-4 rounded-xl font-bold text-lg hover:bg-green-600 transition-all hidden">
            üèÅ Finalizar Corrida
          </button>
        </div>
      </div>

      <!-- Estat√≠sticas do Dia -->
      <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
        <h3 class="text-lg font-bold text-gray-900 mb-4">üìä Estat√≠sticas de Hoje</h3>
        <div class="grid grid-cols-2 gap-4">
          <div class="text-center p-4 bg-green-50 rounded-lg">
            <p class="text-2xl font-bold text-green-600" id="corridas-hoje">0</p>
            <p class="text-sm text-gray-600">Corridas</p>
          </div>
          <div class="text-center p-4 bg-blue-50 rounded-lg">
            <p class="text-2xl font-bold text-blue-600" id="ganhos-hoje">R$ 0,00</p>
            <p class="text-sm text-gray-600">Ganhos</p>
          </div>
          <div class="text-center p-4 bg-purple-50 rounded-lg">
            <p class="text-2xl font-bold text-purple-600" id="tempo-online">0h 0m</p>
            <p class="text-sm text-gray-600">Online</p>
          </div>
          <div class="text-center p-4 bg-yellow-50 rounded-lg">
            <p class="text-2xl font-bold text-yellow-600" id="avaliacao-media">5.0</p>
            <p class="text-sm text-gray-600">Avalia√ß√£o</p>
          </div>
        </div>
      </div>

      <!-- Hist√≥rico de Corridas do Motorista -->
      <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
        <h3 class="text-lg font-bold text-gray-900 mb-4">üìã Hist√≥rico de Corridas</h3>
        <div id="historico-motorista" class="space-y-3">
          <p class="text-gray-500 text-center py-4">Nenhuma corrida realizada ainda</p>
        </div>
      </div>
    </div>
  </div>

  <!-- √Årea Administrativa -->
  <div class="container mx-auto px-4 py-8 max-w-4xl">
    <div class="text-center">
      <button onclick="acessarAdmin()" class="bg-gray-800 text-white px-6 py-3 rounded-lg font-medium hover:bg-gray-900 transition-all">
        üîê √Årea Administrativa
      </button>
    </div>
  </div>

  <!-- Interface Administrativa -->
  <div id="interface-admin" class="container mx-auto px-4 py-8 max-w-6xl hidden">
    <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
      <div class="flex items-center justify-between mb-6">
        <div>
          <h2 class="text-2xl font-bold text-gray-900">üõ†Ô∏è Painel Administrativo</h2>
          <p class="text-gray-600">Gerenciamento de motoristas e corridas</p>
        </div>
        <button onclick="sairAdmin()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-all">
          üö™ Sair
        </button>
      </div>

      <!-- Estat√≠sticas Gerais -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
        <div class="bg-blue-50 p-4 rounded-lg text-center">
          <p class="text-2xl font-bold text-blue-600" id="total-motoristas">0</p>
          <p class="text-sm text-gray-600">Motoristas Ativos</p>
        </div>
        <div class="bg-green-50 p-4 rounded-lg text-center">
          <p class="text-2xl font-bold text-green-600" id="receita-admin">R$ 0,00</p>
          <p class="text-sm text-gray-600">Receita do App</p>
        </div>
        <div class="bg-yellow-50 p-4 rounded-lg text-center">
          <p class="text-2xl font-bold text-yellow-600" id="corridas-total">0</p>
          <p class="text-sm text-gray-600">Corridas Hoje</p>
        </div>
        <div class="bg-purple-50 p-4 rounded-lg text-center">
          <p class="text-2xl font-bold text-purple-600" id="motoristas-online">0</p>
          <p class="text-sm text-gray-600">Online Agora</p>
        </div>
      </div>

      <!-- Gr√°ficos de Performance -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
        <div class="bg-white p-6 rounded-xl shadow-sm border">
          <h3 class="text-lg font-bold text-gray-900 mb-4">üìà Corridas por Hora</h3>
          <canvas id="grafico-corridas" width="400" height="200"></canvas>
        </div>
        <div class="bg-white p-6 rounded-xl shadow-sm border">
          <h3 class="text-lg font-bold text-gray-900 mb-4">üí∞ Receita Di√°ria</h3>
          <canvas id="grafico-receita" width="400" height="200"></canvas>
        </div>
      </div>

      <!-- Controle de Pagamentos -->
      <div class="bg-white rounded-xl shadow-sm border p-6 mb-6">
        <h3 class="text-lg font-bold text-gray-900 mb-4">üí≥ Controle de Pagamentos</h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
          <div class="bg-green-50 p-4 rounded-lg text-center">
            <p class="text-2xl font-bold text-green-600" id="pagamentos-em-dia">0</p>
            <p class="text-sm text-gray-600">Em Dia</p>
          </div>
          <div class="bg-yellow-50 p-4 rounded-lg text-center">
            <p class="text-2xl font-bold text-yellow-600" id="pagamentos-atrasados">0</p>
            <p class="text-sm text-gray-600">Atrasados</p>
          </div>
          <div class="bg-red-50 p-4 rounded-lg text-center">
            <p class="text-2xl font-bold text-red-600" id="pagamentos-bloqueados">0</p>
            <p class="text-sm text-gray-600">Bloqueados</p>
          </div>
        </div>
        <div class="space-y-3" id="lista-pagamentos">
          <p class="text-gray-500 text-center py-4">Carregando informa√ß√µes de pagamento...</p>
        </div>
      </div>

      <!-- Lista de Motoristas -->
      <div class="bg-gray-50 rounded-xl p-6">
        <h3 class="text-lg font-bold text-gray-900 mb-4">üë• Motoristas Cadastrados</h3>
        <div class="space-y-4" id="lista-motoristas">
          <p class="text-gray-500 text-center py-8">Nenhum motorista cadastrado ainda</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de Chat -->
  <div id="modal-chat" class="fixed inset-0 bg-black/50 flex items-center justify-center p-4 hidden z-50">
    <div class="bg-white rounded-2xl w-full max-w-md h-96 flex flex-col">
      <div class="flex items-center justify-between p-4 border-b">
        <h3 class="text-lg font-bold text-gray-900">üí¨ Chat</h3>
        <button onclick="fecharChat()" class="text-gray-500 hover:text-gray-700">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
      
      <div id="mensagens-chat" class="flex-1 p-4 overflow-y-auto space-y-3">
        <div class="bg-gray-100 p-3 rounded-lg max-w-xs">
          <p class="text-sm">Ol√°! Estou a caminho do local de origem.</p>
          <p class="text-xs text-gray-500 mt-1">Motorista ‚Ä¢ 14:30</p>
        </div>
      </div>
      
      <div class="p-4 border-t">
        <div class="flex gap-2">
          <input type="text" id="input-mensagem" placeholder="Digite sua mensagem..." 
                 class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
          <button onclick="enviarMensagemChat()" class="bg-secondary text-white px-4 py-2 rounded-lg hover:bg-secondary/90 transition-all">
            Enviar
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modals -->
  <!-- Modal de Login Admin -->
  <div id="modal-login-admin" class="fixed inset-0 bg-black/50 flex items-center justify-center p-4 hidden z-50">
    <div class="bg-white rounded-2xl p-6 w-full max-w-sm">
      <div class="text-center mb-6">
        <div class="bg-gray-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
          <svg class="w-8 h-8 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
          </svg>
        </div>
        <h3 class="text-xl font-bold text-gray-900 mb-2">Acesso Restrito</h3>
        <p class="text-gray-600">Digite a senha de administrador</p>
      </div>

      <div class="mb-6">
        <input type="password" id="senha-admin" placeholder="Digite a senha" 
               class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent">
        <p id="erro-senha" class="text-red-500 text-sm mt-2 hidden">Senha incorreta!</p>
      </div>

      <div class="flex gap-3">
        <button onclick="cancelarLoginAdmin()" class="flex-1 bg-gray-500 text-white py-3 rounded-lg font-medium hover:bg-gray-600 transition-all">
          Cancelar
        </button>
        <button onclick="validarSenhaAdmin()" class="flex-1 bg-primary text-white py-3 rounded-lg font-medium hover:bg-gray-800 transition-all">
          Entrar
        </button>
      </div>
    </div>
  </div>

  <!-- Modal de Avalia√ß√£o Aprimorado -->
  <div id="modal-avaliacao" class="fixed inset-0 bg-black/50 flex items-center justify-center p-4 hidden z-50">
    <div class="bg-white rounded-2xl p-6 w-full max-w-sm">
      <div class="text-center mb-6">
        <div class="bg-green-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
          <svg class="w-8 h-8 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
          </svg>
        </div>
        <h3 class="text-xl font-bold text-gray-900 mb-2">Corrida Finalizada!</h3>
        <p class="text-gray-600">Como foi sua experi√™ncia?</p>
        <div class="bg-green-100 p-2 rounded-lg mt-2">
          <p class="text-lg font-bold text-green-700">üí∞ R$ 5,00</p>
        </div>
      </div>

      <div class="mb-6">
        <div class="flex justify-center gap-2 mb-4">
          <button onclick="avaliar(1)" class="text-3xl hover:scale-110 transition-transform" data-rating="1">‚≠ê</button>
          <button onclick="avaliar(2)" class="text-3xl hover:scale-110 transition-transform" data-rating="2">‚≠ê</button>
          <button onclick="avaliar(3)" class="text-3xl hover:scale-110 transition-transform" data-rating="3">‚≠ê</button>
          <button onclick="avaliar(4)" class="text-3xl hover:scale-110 transition-transform" data-rating="4">‚≠ê</button>
          <button onclick="avaliar(5)" class="text-3xl hover:scale-110 transition-transform" data-rating="5">‚≠ê</button>
        </div>
        
        <!-- Aspectos espec√≠ficos para avaliar -->
        <div class="space-y-3 mb-4">
          <div class="flex items-center justify-between">
            <span class="text-sm text-gray-600">Pontualidade</span>
            <div class="flex gap-1" id="rating-pontualidade">
              <button onclick="avaliarAspecto('pontualidade', 1)" class="text-lg">‚≠ê</button>
              <button onclick="avaliarAspecto('pontualidade', 2)" class="text-lg">‚≠ê</button>
              <button onclick="avaliarAspecto('pontualidade', 3)" class="text-lg">‚≠ê</button>
              <button onclick="avaliarAspecto('pontualidade', 4)" class="text-lg">‚≠ê</button>
              <button onclick="avaliarAspecto('pontualidade', 5)" class="text-lg">‚≠ê</button>
            </div>
          </div>
          <div class="flex items-center justify-between">
            <span class="text-sm text-gray-600">Dire√ß√£o</span>
            <div class="flex gap-1" id="rating-direcao">
              <button onclick="avaliarAspecto('direcao', 1)" class="text-lg">‚≠ê</button>
              <button onclick="avaliarAspecto('direcao', 2)" class="text-lg">‚≠ê</button>
              <button onclick="avaliarAspecto('direcao', 3)" class="text-lg">‚≠ê</button>
              <button onclick="avaliarAspecto('direcao', 4)" class="text-lg">‚≠ê</button>
              <button onclick="avaliarAspecto('direcao', 5)" class="text-lg">‚≠ê</button>
            </div>
          </div>
          <div class="flex items-center justify-between">
            <span class="text-sm text-gray-600">Atendimento</span>
            <div class="flex gap-1" id="rating-atendimento">
              <button onclick="avaliarAspecto('atendimento', 1)" class="text-lg">‚≠ê</button>
              <button onclick="avaliarAspecto('atendimento', 2)" class="text-lg">‚≠ê</button>
              <button onclick="avaliarAspecto('atendimento', 3)" class="text-lg">‚≠ê</button>
              <button onclick="avaliarAspecto('atendimento', 4)" class="text-lg">‚≠ê</button>
              <button onclick="avaliarAspecto('atendimento', 5)" class="text-lg">‚≠ê</button>
            </div>
          </div>
        </div>
        
        <textarea id="comentario-avaliacao" placeholder="Deixe um coment√°rio (opcional)" 
                  class="w-full p-3 border border-gray-300 rounded-lg resize-none" rows="3"></textarea>
      </div>

      <button onclick="enviarAvaliacao()" class="w-full bg-secondary text-white py-3 rounded-lg font-medium hover:bg-secondary/90 transition-all">
        Enviar Avalia√ß√£o
      </button>
    </div>
  </div>

  <script>
    // Configura√ß√£o do Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyAJk8-W80iJyGHoJBeNZDo5k9wmh8HRPrQ",
      authDomain: "mototaxi-tapaua.firebaseapp.com",
      databaseURL: "https://mototaxi-tapaua-default-rtdb.firebaseio.com",
      projectId: "mototaxi-tapaua",
      storageBucket: "mototaxi-tapaua.firebasestorage.app",
      messagingSenderId: "629986832248",
      appId: "1:629986832248:web:fd044f24cc51aa018ba28d",
      measurementId: "G-1S6PYNHWN5"
    };

    // Inicializar Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // Monitorar conex√£o com Firebase
    database.ref('.info/connected').on('value', (snapshot) => {
      const statusElement = document.getElementById('status-dispositivo');
      if (snapshot.val() === true) {
        statusElement.textContent = 'üü¢ Online';
        statusElement.className = 'text-xs text-green-600';
        console.log('Conectado ao Firebase');
      } else {
        statusElement.textContent = 'üî¥ Offline';
        statusElement.className = 'text-xs text-red-600';
        console.log('Desconectado do Firebase');
      }
    });

    // Estado global da aplica√ß√£o
    let interfaceAtual = 'passageiro';
    let statusMotorista = 'offline';
    let corridaAtiva = null;
    let avaliacaoSelecionada = 0;
    let avaliacaoAspectos = {
      pontualidade: 0,
      direcao: 0,
      atendimento: 0
    };
    let intervalos = {};
    let motoristaCadastrado = false;
    let motoristaAtual = null;
    let corridasAtivas = [];
    let proximoIdCorrida = 1;
    let deviceId = 'device_' + Math.random().toString(36).substr(2, 9);
    let historicoPassageiro = [];
    let historicoMotorista = [];
    let chatMensagens = [];

    // Dados dos motoristas cadastrados (agora sincronizados com Firebase)
    let motoristas = [];

    // Sistema de corridas em tempo real (agora no Firebase)
    let sistemaCorridas = {
      solicitacoes: [],
      corridasEmAndamento: [],
      receitaTotal: 0,
      corridasFinalizadas: []
    };

    // === FUN√á√ïES DO FIREBASE ===
    
    // Sincronizar motoristas em tempo real
    function iniciarSincronizacaoMotoristas() {
      database.ref('motoristas').on('value', (snapshot) => {
        const data = snapshot.val();
        motoristas = data ? Object.values(data) : [];
        atualizarEstatisticasAdmin();
        atualizarListaMotoristas();
        atualizarControlePagamentos();
        console.log('Motoristas sincronizados:', motoristas.length);
      });
    }

    // Sincronizar corridas em tempo real
    function iniciarSincronizacaoCorridas() {
      // Escutar novas solicita√ß√µes
      database.ref('corridas/solicitacoes').on('child_added', (snapshot) => {
        const corrida = snapshot.val();
        if (corrida && corrida.status === 'procurando') {
          console.log('Nova corrida detectada:', corrida);
          
          // Se √© motorista online, mostrar notifica√ß√£o
          if (interfaceAtual === 'motorista' && statusMotorista === 'online' && motoristaAtual) {
            mostrarSolicitacaoParaMotorista(corrida);
          }
          
          // Atualizar notifica√ß√µes
          atualizarNotificacoes();
        }
      });

      // Escutar mudan√ßas de status das corridas
      database.ref('corridas/solicitacoes').on('child_changed', (snapshot) => {
        const corrida = snapshot.val();
        console.log('Status da corrida alterado:', corrida);
        
        // Se a corrida foi aceita e √© a corrida ativa do passageiro
        if (corrida.status === 'aceita' && corridaAtiva && corridaAtiva.id === corrida.id) {
          // Buscar dados do motorista
          database.ref(`motoristas/${corrida.motoristaId}`).once('value', (motoristaSnapshot) => {
            const motorista = motoristaSnapshot.val();
            if (motorista) {
              corridaAceita(motorista);
            }
          });
        }
      });

      // Escutar corridas finalizadas
      database.ref('corridas/finalizadas').on('child_added', (snapshot) => {
        const corrida = snapshot.val();
        sistemaCorridas.receitaTotal += 1.00; // Taxa do app
        atualizarEstatisticasAdmin();
        atualizarHistorico(corrida);
      });
    }

    // Salvar motorista no Firebase
    function salvarMotoristaFirebase(motorista) {
      return database.ref(`motoristas/${motorista.id}`).set(motorista);
    }

    // Atualizar status online do motorista
    function atualizarStatusMotorista(motoristaId, online) {
      return database.ref(`motoristas/${motoristaId}/online`).set(online);
    }

    // Criar nova solicita√ß√£o de corrida no Firebase
    function criarSolicitacaoFirebase(corrida) {
      return database.ref(`corridas/solicitacoes/${corrida.id}`).set(corrida);
    }

    // Aceitar corrida no Firebase
    function aceitarCorridaFirebase(corridaId, motoristaId) {
      const updates = {};
      updates[`corridas/solicitacoes/${corridaId}/status`] = 'aceita';
      updates[`corridas/solicitacoes/${corridaId}/motoristaId`] = motoristaId;
      updates[`corridas/solicitacoes/${corridaId}/dataAceite`] = firebase.database.ServerValue.TIMESTAMP;
      
      return database.ref().update(updates);
    }

    // Finalizar corrida no Firebase
    function finalizarCorridaFirebase(corrida) {
      const updates = {};
      
      // Remover da lista de solicita√ß√µes
      updates[`corridas/solicitacoes/${corrida.id}`] = null;
      
      // Adicionar √†s finalizadas
      updates[`corridas/finalizadas/${corrida.id}`] = {
        ...corrida,
        status: 'finalizada',
        dataFinalizacao: firebase.database.ServerValue.TIMESTAMP
      };
      
      // Atualizar estat√≠sticas do motorista
      updates[`motoristas/${corrida.motoristaId}/corridasHoje`] = firebase.database.ServerValue.increment(1);
      updates[`motoristas/${corrida.motoristaId}/ganhosHoje`] = firebase.database.ServerValue.increment(4.00);
      
      return database.ref().update(updates);
    }

    // Salvar avalia√ß√£o no Firebase
    function salvarAvaliacaoFirebase(avaliacao) {
      return database.ref(`avaliacoes/${avaliacao.corridaId}`).set(avaliacao);
    }

    // Salvar mensagem de chat no Firebase
    function salvarMensagemFirebase(mensagem) {
      return database.ref(`chats/${mensagem.corridaId}`).push(mensagem);
    }

    // Inicializa√ß√£o
    document.addEventListener('DOMContentLoaded', function() {
      formatarCPF();
      
      // Iniciar sincroniza√ß√£o com Firebase
      iniciarSincronizacaoMotoristas();
      iniciarSincronizacaoCorridas();
      
      // Carregar hist√≥ricos do localStorage
      carregarHistoricos();
      
      // Inicializar gr√°ficos
      setTimeout(() => {
        inicializarGraficos();
        atualizarEstatisticasAdmin();
        
        // Se n√£o h√° motoristas, criar um de exemplo
        if (motoristas.length === 0) {
          const motoristaExemplo = {
            id: 1,
            nome: 'Jo√£o Silva',
            cpf: '123.456.789-00',
            telefone: '(97) 99999-9999',
            online: false,
            corridasHoje: 0,
            ganhosHoje: 0,
            deviceId: 'exemplo_device',
            ultimoPagamento: Date.now(),
            diasAtraso: 0
          };
          
          salvarMotoristaFirebase(motoristaExemplo).then(() => {
            console.log('Motorista de exemplo criado');
          });
        }
      }, 2000);
    });

    // Formata√ß√£o de CPF
    function formatarCPF() {
      const cpfInput = document.getElementById('cpf-motorista');
      if (cpfInput) {
        cpfInput.addEventListener('input', function(e) {
          let value = e.target.value.replace(/\D/g, '');
          value = value.replace(/(\d{3})(\d)/, '$1.$2');
          value = value.replace(/(\d{3})(\d)/, '$1.$2');
          value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
          e.target.value = value;
        });
      }
    }

    // Valida√ß√£o de CPF
    function validarCPF(cpf) {
      cpf = cpf.replace(/[^\d]+/g, '');
      if (cpf.length !== 11 || /^(\d)\1{10}$/.test(cpf)) return false;
      
      let soma = 0;
      for (let i = 0; i < 9; i++) {
        soma += parseInt(cpf.charAt(i)) * (10 - i);
      }
      let resto = 11 - (soma % 11);
      if (resto === 10 || resto === 11) resto = 0;
      if (resto !== parseInt(cpf.charAt(9))) return false;
      
      soma = 0;
      for (let i = 0; i < 10; i++) {
        soma += parseInt(cpf.charAt(i)) * (11 - i);
      }
      resto = 11 - (soma % 11);
      if (resto === 10 || resto === 11) resto = 0;
      return resto === parseInt(cpf.charAt(10));
    }

    // Fun√ß√µes de Interface
    function mostrarInterface(tipo) {
      interfaceAtual = tipo;
      
      // Esconder todas as interfaces
      document.getElementById('interface-passageiro').classList.add('hidden');
      document.getElementById('interface-motorista').classList.add('hidden');
      document.getElementById('interface-admin').classList.add('hidden');
      
      // Resetar bot√µes
      document.getElementById('btn-passageiro').classList.remove('bg-primary', 'text-white');
      document.getElementById('btn-passageiro').classList.add('border', 'border-gray-300', 'text-gray-700');
      document.getElementById('btn-motorista').classList.remove('bg-primary', 'text-white');
      document.getElementById('btn-motorista').classList.add('border', 'border-gray-300', 'text-gray-700');
      
      if (tipo === 'passageiro') {
        document.getElementById('interface-passageiro').classList.remove('hidden');
        document.getElementById('btn-passageiro').classList.add('bg-primary', 'text-white');
        document.getElementById('btn-passageiro').classList.remove('border', 'border-gray-300', 'text-gray-700');
        atualizarHistoricoPassageiro();
      } else if (tipo === 'motorista') {
        document.getElementById('interface-motorista').classList.remove('hidden');
        document.getElementById('btn-motorista').classList.add('bg-primary', 'text-white');
        document.getElementById('btn-motorista').classList.remove('border', 'border-gray-300', 'text-gray-700');
        
        // Verificar se o motorista j√° est√° cadastrado
        verificarStatusMotorista();
      }
    }

    // Fun√ß√£o para verificar se o motorista j√° est√° cadastrado
    function verificarStatusMotorista() {
      // Verificar se h√° um motorista cadastrado neste dispositivo
      const motoristaLocal = localStorage.getItem('motoristaAtual');
      
      if (motoristaLocal) {
        try {
          motoristaAtual = JSON.parse(motoristaLocal);
          motoristaCadastrado = true;
          
          // Mostrar painel do motorista
          document.getElementById('cadastro-motorista').classList.add('hidden');
          document.getElementById('painel-motorista').classList.remove('hidden');
          
          // Atualizar informa√ß√µes
          atualizarInfoMotorista();
          atualizarHistoricoMotorista();
          
          console.log('Motorista j√° cadastrado encontrado:', motoristaAtual);
        } catch (e) {
          console.error('Erro ao carregar dados do motorista:', e);
          localStorage.removeItem('motoristaAtual');
        }
      } else {
        // Mostrar formul√°rio de cadastro
        document.getElementById('cadastro-motorista').classList.remove('hidden');
        document.getElementById('painel-motorista').classList.add('hidden');
      }
    }

    // === FUN√á√ïES DO PASSAGEIRO ===
    function obterLocalizacao(campo) {
      const input = document.getElementById(campo);
      input.value = 'Obtendo localiza√ß√£o...';
      
      // Simular geolocaliza√ß√£o real
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            // Simular convers√£o de coordenadas para endere√ßo
            const locais = [
              'Rua das Flores, 123 - Centro, Tapau√°',
              'Av. Principal, 456 - Centro, Tapau√°',
              'Rua do Com√©rcio, 789 - Centro, Tapau√°',
              'Pra√ßa da Matriz, s/n - Centro, Tapau√°',
              'Rua Amazonas, 321 - Bairro Novo, Tapau√°'
            ];
            input.value = locais[Math.floor(Math.random() * locais.length)];
          },
          (error) => {
            // Fallback para locais conhecidos
            const locais = [
              'Centro de Tapau√°',
              'Mercado Municipal',
              'Hospital de Tapau√°',
              'Escola Estadual',
              'Porto de Tapau√°'
            ];
            input.value = locais[Math.floor(Math.random() * locais.length)];
          }
        );
      } else {
        setTimeout(() => {
          const locais = [
            'Rua das Flores, 123 - Centro, Tapau√°',
            'Av. Principal, 456 - Centro, Tapau√°',
            'Rua do Com√©rcio, 789 - Centro, Tapau√°'
          ];
          input.value = locais[Math.floor(Math.random() * locais.length)];
        }, 2000);
      }
    }

    function solicitarCorrida() {
      const origem = document.getElementById('origem').value;
      const destino = document.getElementById('destino').value;
      
      if (!origem || !destino) {
        alert('Por favor, preencha origem e destino');
        return;
      }

      // Verificar se h√° motoristas online
      const motoristasOnline = motoristas.filter(m => m.online);
      if (motoristasOnline.length === 0) {
        alert('Nenhum motorista dispon√≠vel no momento. Tente novamente em alguns minutos.');
        return;
      }
      
      // Criar nova solicita√ß√£o de corrida
      const novaCorrida = {
        id: Date.now(), // Usar timestamp como ID √∫nico
        origem: origem,
        destino: destino,
        passageiro: 'Cliente',
        passageiroDevice: deviceId,
        valor: 5.00,
        status: 'procurando',
        timestamp: firebase.database.ServerValue.TIMESTAMP,
        motoristaId: null
      };
      
      corridaAtiva = novaCorrida;
      
      // Mostrar interface de busca
      document.getElementById('status-corrida').classList.remove('hidden');
      document.getElementById('btn-solicitar').disabled = true;
      
      // Salvar no Firebase - isso automaticamente notificar√° todos os motoristas online
      criarSolicitacaoFirebase(novaCorrida).then(() => {
        console.log('Corrida salva no Firebase:', novaCorrida);
        
        // Iniciar contador de busca
        iniciarContadorBusca();
        
        // Timeout para cancelar se ningu√©m aceitar
        setTimeout(() => {
          if (corridaAtiva && corridaAtiva.status === 'procurando') {
            cancelarCorridaPorTimeout();
          }
        }, 60000); // 60 segundos
        
      }).catch((error) => {
        console.error('Erro ao salvar corrida:', error);
        alert('Erro ao solicitar corrida. Tente novamente.');
        resetarInterfacePassageiro();
      });
    }

    function iniciarContadorBusca() {
      let tempo = 0;
      intervalos.busca = setInterval(() => {
        document.getElementById('tempo-busca').textContent = tempo;
        tempo++;
        
        // Timeout ap√≥s 60 segundos
        if (tempo > 60) {
          clearInterval(intervalos.busca);
          cancelarCorridaPorTimeout();
        }
      }, 1000);
    }

    function cancelarCorridaPorTimeout() {
      alert('N√£o foi poss√≠vel encontrar um motorista. Tente novamente.');
      resetarInterfacePassageiro();
    }

    function corridaAceita(motorista) {
      clearInterval(intervalos.busca);
      
      // Atualizar status da corrida
      if (corridaAtiva) {
        corridaAtiva.status = 'aceita';
        corridaAtiva.motoristaId = motorista.id;
        corridaAtiva.motorista = motorista;
      }
      
      // Atualizar interface
      document.getElementById('status-titulo').textContent = 'Motorista encontrado!';
      document.getElementById('status-descricao').textContent = `${motorista.nome} est√° a caminho`;
      document.getElementById('nome-motorista').textContent = motorista.nome;
      document.getElementById('veiculo-motorista').textContent = 'Moto-t√°xi ‚Ä¢ Tapau√°';
      
      document.getElementById('status-icon').innerHTML = `
        <svg class="w-10 h-10 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
        </svg>
      `;
      
      document.getElementById('info-motorista').classList.remove('hidden');
      document.getElementById('contador-busca').classList.add('hidden');
      
      iniciarContadorChegada();
    }

    function iniciarContadorChegada() {
      let tempo = 300; // 5 minutos
      let progresso = 0;
      
      intervalos.chegada = setInterval(() => {
        const minutos = Math.floor(tempo / 60);
        const segundos = tempo % 60;
        document.getElementById('tempo-chegada').textContent = `${minutos}:${segundos.toString().padStart(2, '0')}`;
        
        progresso = ((300 - tempo) / 300) * 100;
        document.getElementById('progresso-chegada').style.width = progresso + '%';
        
        if (tempo <= 0) {
          clearInterval(intervalos.chegada);
          motoristasChegou();
        }
        tempo--;
      }, 1000);
    }

    function motoristasChegou() {
      document.getElementById('info-motorista').classList.add('hidden');
      document.getElementById('corrida-em-andamento').classList.remove('hidden');
      
      if (corridaAtiva) {
        corridaAtiva.status = 'em_andamento';
      }
    }

    function ligarMotorista() {
      if (corridaAtiva && corridaAtiva.motorista) {
        alert(`Ligando para ${corridaAtiva.motorista.nome}...\nüìû ${corridaAtiva.motorista.telefone}`);
      }
    }

    function abrirChatPassageiro() {
      document.getElementById('modal-chat').classList.remove('hidden');
      carregarMensagensChat();
    }

    function cancelarCorrida() {
      if (confirm('Tem certeza que deseja cancelar a corrida?')) {
        if (corridaAtiva) {
          // Remover da lista de solicita√ß√µes no Firebase
          database.ref(`corridas/solicitacoes/${corridaAtiva.id}`).remove();
        }
        
        resetarInterfacePassageiro();
        clearInterval(intervalos.busca);
        clearInterval(intervalos.chegada);
      }
    }

    function resetarInterfacePassageiro() {
      corridaAtiva = null;
      document.getElementById('status-corrida').classList.add('hidden');
      document.getElementById('btn-solicitar').disabled = false;
      document.getElementById('origem').value = '';
      document.getElementById('destino').value = '';
    }

    // === FUN√á√ïES DO MOTORISTA ===
    function cadastrarMotorista() {
      const nome = document.getElementById('nome-motorista').value.trim();
      const cpf = document.getElementById('cpf-motorista').value.trim();
      const telefone = document.getElementById('telefone-motorista').value.trim();
      const cpfErro = document.getElementById('cpf-erro');

      // Apenas o nome √© obrigat√≥rio
      if (!nome) {
        alert('Por favor, preencha pelo menos o seu nome');
        return;
      }

      // Validar CPF apenas se foi preenchido
      if (cpf && !validarCPF(cpf)) {
        cpfErro.classList.remove('hidden');
        return;
      }

      cpfErro.classList.add('hidden');
      
      // Criar novo motorista
      const novoMotorista = {
        id: Date.now(), // ID √∫nico baseado em timestamp
        nome: nome,
        cpf: cpf || 'N√£o informado',
        telefone: telefone || 'N√£o informado',
        online: false,
        corridasHoje: 0,
        ganhosHoje: 0,
        deviceId: deviceId,
        dataCadastro: new Date().toISOString(),
        ultimoPagamento: Date.now(),
        diasAtraso: 0,
        avaliacaoMedia: 5.0,
        totalAvaliacoes: 0
      };

      console.log('Tentando cadastrar motorista:', novoMotorista);

      // Salvar no Firebase
      salvarMotoristaFirebase(novoMotorista).then(() => {
        console.log('Motorista salvo no Firebase com sucesso');
        motoristaAtual = novoMotorista;
        motoristaCadastrado = true;
        
        // Salvar tamb√©m no localStorage para persistir entre sess√µes
        localStorage.setItem('motoristaAtual', JSON.stringify(novoMotorista));
        
        // Esconder formul√°rio de cadastro
        document.getElementById('cadastro-motorista').classList.add('hidden');
        // Mostrar painel do motorista
        document.getElementById('painel-motorista').classList.remove('hidden');
        
        // Atualizar informa√ß√µes do motorista no painel
        atualizarInfoMotorista();
        
        alert('‚úÖ Cadastro realizado com sucesso!\n\nAgora voc√™ pode:\n‚Ä¢ Ficar online para receber corridas\n‚Ä¢ Acompanhar seus ganhos\n‚Ä¢ Gerenciar seu status');
        
      }).catch((error) => {
        console.error('Erro ao cadastrar motorista:', error);
        alert('‚ùå Erro ao realizar cadastro.\n\nTente novamente em alguns segundos.');
      });
    }

    // Fun√ß√£o para atualizar informa√ß√µes do motorista no painel
    function atualizarInfoMotorista() {
      if (motoristaAtual) {
        // Atualizar nome do motorista em locais relevantes
        const elementosNome = document.querySelectorAll('.nome-motorista-display');
        elementosNome.forEach(el => {
          el.textContent = motoristaAtual.nome;
        });
        
        // Atualizar estat√≠sticas
        document.getElementById('corridas-hoje').textContent = motoristaAtual.corridasHoje || 0;
        document.getElementById('ganhos-hoje').textContent = `R$ ${(motoristaAtual.ganhosHoje || 0).toFixed(2)}`;
        document.getElementById('avaliacao-media').textContent = (motoristaAtual.avaliacaoMedia || 5.0).toFixed(1);
      }
    }

    function alternarStatus() {
      if (!motoristaCadastrado) {
        alert('Voc√™ precisa se cadastrar primeiro!');
        return;
      }

      const btn = document.getElementById('btn-status');
      const icon = document.getElementById('status-motorista-icon');
      const texto = document.getElementById('status-motorista-texto');
      
      if (statusMotorista === 'offline') {
        statusMotorista = 'online';
        
        // Atualizar no Firebase
        atualizarStatusMotorista(motoristaAtual.id, true).then(() => {
          console.log('Status atualizado para online no Firebase');
          
          btn.textContent = 'üî¥ Ficar Offline';
          btn.classList.remove('bg-green-500', 'hover:bg-green-600');
          btn.classList.add('bg-red-500', 'hover:bg-red-600');
          
          icon.classList.remove('bg-red-100');
          icon.classList.add('bg-green-100');
          icon.innerHTML = `
            <svg class="w-10 h-10 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
            </svg>
          `;
          
          texto.textContent = 'Online - Aguardando corridas';
          
          // Verificar se h√° solicita√ß√µes pendentes
          verificarSolicitacoesPendentes();
          
        }).catch((error) => {
          console.error('Erro ao atualizar status:', error);
          alert('Erro ao ficar online. Tente novamente.');
        });
        
      } else {
        statusMotorista = 'offline';
        
        // Atualizar no Firebase
        atualizarStatusMotorista(motoristaAtual.id, false).then(() => {
          console.log('Status atualizado para offline no Firebase');
          
          btn.textContent = 'üü¢ Ficar Online';
          btn.classList.remove('bg-red-500', 'hover:bg-red-600');
          btn.classList.add('bg-green-500', 'hover:bg-green-600');
          
          icon.classList.remove('bg-green-100');
          icon.classList.add('bg-red-100');
          icon.innerHTML = `
            <svg class="w-10 h-10 text-red-500" fill="none" stroke="currentColor" viewBox="0 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'95a23a1af534f502',t:'MTc1MTY2OTkwMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
