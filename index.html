<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MotoT√°xi Tapau√° - Conectando voc√™ ao seu destino</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#000000',
            secondary: '#00D4AA',
            accent: '#FFB800'
          }
        }
      }
    }
  </script>
</head>
<body class="bg-gray-50 min-h-screen">
  <!-- Header -->
  <header class="bg-white shadow-sm border-b sticky top-0 z-40">
    <div class="container mx-auto px-4 py-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <div class="bg-primary text-white p-2 rounded-lg">
            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 2L13.09 8.26L22 9L13.09 9.74L12 16L10.91 9.74L2 9L10.91 8.26L12 2Z"/>
            </svg>
          </div>
          <div>
            <h1 class="text-xl font-bold text-gray-900">MotoT√°xi Tapau√°</h1>
            <p class="text-sm text-gray-500">Conectando voc√™ ao seu destino</p>
            <p id="status-dispositivo" class="text-xs text-yellow-600">üü° Conectando...</p>
          </div>
        </div>
        <div class="flex items-center gap-3">
          <!-- Indicador de Notifica√ß√µes -->
          <div id="notification-badge" class="relative">
            <svg class="w-6 h-6 text-red-500" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 19V20H3V19L5 17V11C5 7.9 7 5.2 10 4.3V4C10 2.9 10.9 2 12 2S14 2.9 14 4V4.3C17 5.2 19 7.9 19 11V17L21 19ZM12 22C10.9 22 10 21.1 10 20H14C14 21.1 13.1 22 12 22Z"/>
            </svg>
            <span id="badge-count" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold hidden">0</span>
          </div>
          
          <div class="flex gap-2">
            <button id="btn-passageiro" onclick="mostrarInterface('passageiro')" 
                    class="px-4 py-2 bg-primary text-white rounded-lg font-medium transition-all hover:bg-gray-800">
              Passageiro
            </button>
            <button id="btn-motorista" onclick="mostrarInterface('motorista')" 
                    class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg font-medium transition-all hover:bg-gray-50">
              Motorista
            </button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Interface do Passageiro -->
  <div id="interface-passageiro" class="container mx-auto px-4 py-8 max-w-md">
    <!-- Solicitar Corrida -->
    <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
      <div class="text-center mb-6">
        <div class="bg-secondary/10 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
          <svg class="w-10 h-10 text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
          </svg>
        </div>
        <h2 class="text-2xl font-bold text-gray-900 mb-2">Para onde vamos?</h2>
        <p class="text-gray-600">Solicite sua corrida agora</p>
      </div>

      <div class="space-y-4 mb-6">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">üìç Origem</label>
          <div class="relative">
            <input type="text" id="origem" placeholder="Digite o local de partida ou use GPS" 
                   class="w-full px-4 py-3 pr-12 border border-gray-300 rounded-xl focus:ring-2 focus:ring-secondary focus:border-transparent">
            <button onclick="obterLocalizacao('origem')" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-secondary hover:text-secondary/80">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
              </svg>
            </button>
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">üéØ Destino</label>
          <input type="text" id="destino" placeholder="Para onde voc√™ quer ir?" 
                 class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-secondary focus:border-transparent">
        </div>

        <!-- Pre√ßo Fixo -->
        <div class="bg-green-50 p-4 rounded-xl border border-green-200">
          <div class="flex justify-between items-center">
            <div>
              <p class="text-sm text-gray-600">Tarifa Fixa</p>
              <p class="text-2xl font-bold text-green-600">R$ 5,00</p>
            </div>
            <div class="text-right">
              <p class="text-sm text-gray-600">Tempo estimado</p>
              <p class="text-lg font-bold text-gray-900">5-15 min</p>
            </div>
          </div>
        </div>
      </div>

      <button onclick="solicitarCorrida()" id="btn-solicitar" 
              class="w-full bg-secondary text-white py-4 rounded-xl font-bold text-lg hover:bg-secondary/90 transition-all transform hover:scale-105 shadow-lg">
        üöÄ Solicitar MotoT√°xi - R$ 5,00
      </button>
    </div>

    <!-- Status da Corrida -->
    <div id="status-corrida" class="bg-white rounded-2xl shadow-lg p-6 mb-6 hidden">
      <div class="text-center mb-4">
        <div id="status-icon" class="w-20 h-20 bg-accent/10 rounded-full flex items-center justify-center mx-auto mb-4">
          <div class="animate-spin">
            <svg class="w-10 h-10 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
            </svg>
          </div>
        </div>
        <h3 id="status-titulo" class="text-xl font-bold text-gray-900 mb-2">Procurando motorista...</h3>
        <p id="status-descricao" class="text-gray-600">Enviando solicita√ß√£o para todos os motoristas dispon√≠veis</p>
        <div id="contador-busca" class="mt-2">
          <p class="text-sm text-blue-600">‚è±Ô∏è Buscando h√° <span id="tempo-busca">0</span> segundos</p>
        </div>
      </div>

      <!-- Informa√ß√µes do Motorista -->
      <div id="info-motorista" class="border-t pt-4 hidden">
        <div class="flex items-center gap-4 mb-4">
          <div class="w-16 h-16 bg-gray-300 rounded-full flex items-center justify-center">
            <span class="text-2xl">üèçÔ∏è</span>
          </div>
          <div class="flex-1">
            <h4 id="nome-motorista" class="font-bold text-gray-900 text-lg">Jo√£o Silva</h4>
            <div class="flex items-center gap-1 mb-1">
              <span class="text-accent">‚≠ê</span>
              <span class="text-sm text-gray-600">4.8 (127 avalia√ß√µes)</span>
            </div>
            <p id="veiculo-motorista" class="text-sm text-gray-500">Honda CG 160 ‚Ä¢ ABC-1234</p>
            <p class="text-sm font-medium text-green-600">‚úÖ Motorista a caminho</p>
          </div>
        </div>

        <!-- Tempo de Chegada -->
        <div class="bg-blue-50 p-4 rounded-lg mb-4">
          <div class="flex items-center justify-between mb-2">
            <span class="text-sm text-gray-600">Chegada em:</span>
            <span id="tempo-chegada" class="font-bold text-blue-600 text-lg">3 min</span>
          </div>
          <div class="w-full bg-blue-200 rounded-full h-3">
            <div id="progresso-chegada" class="bg-blue-600 h-3 rounded-full transition-all duration-1000" style="width: 0%"></div>
          </div>
        </div>

        <!-- Bot√µes de A√ß√£o -->
        <div class="flex gap-3">
          <button onclick="ligarMotorista()" class="flex-1 bg-green-500 text-white py-3 rounded-lg font-medium hover:bg-green-600 transition-all">
            üìû Ligar
          </button>
          <button onclick="enviarMensagem()" class="flex-1 bg-blue-500 text-white py-3 rounded-lg font-medium hover:bg-blue-600 transition-all">
            üí¨ Chat
          </button>
          <button onclick="cancelarCorrida()" class="flex-1 bg-red-500 text-white py-3 rounded-lg font-medium hover:bg-red-600 transition-all">
            ‚ùå Cancelar
          </button>
        </div>
      </div>

      <!-- Corrida em Andamento -->
      <div id="corrida-em-andamento" class="border-t pt-4 hidden">
        <div class="bg-green-50 p-4 rounded-lg mb-4">
          <div class="text-center">
            <h4 class="font-bold text-green-700 mb-2">üèçÔ∏è Corrida em Andamento</h4>
            <p class="text-sm text-gray-600">Voc√™ est√° a caminho do destino</p>
            <p class="text-lg font-bold text-green-600 mt-2">R$ 5,00</p>
          </div>
        </div>
        
        <div class="flex gap-3">
          <button onclick="ligarMotorista()" class="flex-1 bg-green-500 text-white py-3 rounded-lg font-medium hover:bg-green-600 transition-all">
            üìû Ligar
          </button>
          <button onclick="abrirChat()" class="flex-1 bg-blue-500 text-white py-3 rounded-lg font-medium hover:bg-blue-600 transition-all">
            üí¨ Chat
          </button>
        </div>
      </div>
    </div>


  </div>

  <!-- Interface do Motorista -->
  <div id="interface-motorista" class="container mx-auto px-4 py-8 max-w-md hidden">
    <!-- Cadastro/Login do Motorista -->
    <div id="cadastro-motorista" class="bg-white rounded-2xl shadow-lg p-6 mb-6">
      <div class="text-center mb-6">
        <div class="bg-primary/10 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
          <svg class="w-10 h-10 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
          </svg>
        </div>
        <h2 class="text-2xl font-bold text-gray-900 mb-2">Cadastro de Motorista</h2>
        <p class="text-gray-600">Preencha seus dados para come√ßar</p>
      </div>

      <div class="space-y-4 mb-6">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Nome Completo</label>
          <input type="text" id="nome-motorista" placeholder="Digite seu nome completo" 
                 class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-secondary focus:border-transparent">
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">CPF</label>
          <input type="text" id="cpf-motorista" placeholder="000.000.000-00" maxlength="14"
                 class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-secondary focus:border-transparent">
          <p id="cpf-erro" class="text-red-500 text-sm mt-1 hidden">CPF inv√°lido</p>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Telefone</label>
          <input type="text" id="telefone-motorista" placeholder="(97) 99999-9999" 
                 class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-secondary focus:border-transparent">
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Placa da Moto</label>
          <input type="text" id="placa-motorista" placeholder="ABC-1234" 
                 class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-secondary focus:border-transparent">
        </div>
      </div>

      <button onclick="cadastrarMotorista()" id="btn-cadastrar" 
              class="w-full bg-secondary text-white py-4 rounded-xl font-bold text-lg hover:bg-secondary/90 transition-all">
        ‚úÖ Cadastrar-se
      </button>
    </div>

    <!-- Painel do Motorista -->
    <div id="painel-motorista" class="hidden">
      <!-- Status do Motorista -->
      <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
        <div class="text-center mb-6">
          <div id="status-motorista-icon" class="bg-red-100 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
            <svg class="w-10 h-10 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728L5.636 5.636m12.728 12.728L18.364 5.636M5.636 18.364l12.728-12.728"/>
            </svg>
          </div>
          <h2 id="status-motorista-texto" class="text-2xl font-bold text-gray-900 mb-2">Offline</h2>
          <p class="text-gray-600">Toque para ficar dispon√≠vel para corridas</p>
        </div>

        <button onclick="alternarStatus()" id="btn-status" 
                class="w-full bg-green-500 text-white py-4 rounded-xl font-bold text-lg hover:bg-green-600 transition-all transform hover:scale-105 shadow-lg">
          üü¢ Ficar Online
        </button>
      </div>

      <!-- Pagamento do Aplicativo -->
      <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
        <div class="text-center mb-4">
          <div class="bg-accent/10 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
            <svg class="w-8 h-8 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"/>
            </svg>
          </div>
          <h3 class="text-lg font-bold text-gray-900 mb-2">üí≥ Pagar Aplicativo</h3>
          <p class="text-gray-600">Taxa di√°ria: R$ 5,00</p>
          <p id="status-pagamento" class="text-sm font-medium mt-2">
            <span class="text-red-500">‚ö†Ô∏è Pagamento em atraso: 2 dias</span>
          </p>
        </div>

        <div class="bg-gray-50 p-4 rounded-lg mb-4">
          <p class="text-sm text-gray-600 mb-2">C√≥digo PIX (Copie e cole no seu banco):</p>
          <div class="bg-white p-3 rounded border border-dashed border-gray-300">
            <p id="codigo-pix" class="text-xs font-mono break-all text-gray-800">
              00020126580014br.gov.bcb.pix013603383948269520400005303986540550.005802BR5925ADMINISTRADOR MOTOTAXI6007TAPAAUA62070503***6304
            </p>
          </div>
        </div>

        <div class="flex gap-3">
          <button onclick="copiarPix()" class="flex-1 bg-blue-500 text-white py-3 rounded-lg font-medium hover:bg-blue-600 transition-all">
            üìã Copiar PIX
          </button>
          <button onclick="confirmarPagamento()" class="flex-1 bg-green-500 text-white py-3 rounded-lg font-medium hover:bg-green-600 transition-all">
            ‚úÖ J√° Paguei
          </button>
        </div>
      </div>

      <!-- Nova Solicita√ß√£o de Corrida -->
      <div id="nova-solicitacao" class="bg-white rounded-2xl shadow-lg p-6 mb-6 hidden border-4 border-accent animate-pulse">
        <div class="text-center mb-4">
          <div class="bg-accent/20 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
            <svg class="w-10 h-10 text-accent animate-bounce" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
          </div>
          <h3 class="text-2xl font-bold text-gray-900 mb-2">üö® Nova Corrida!</h3>
          <p class="text-gray-600">Passageiro aguardando</p>
          <div class="bg-green-100 p-2 rounded-lg mt-2">
            <p class="text-lg font-bold text-green-700">üí∞ R$ 5,00 (Voc√™ ganha R$ 4,00)</p>
          </div>
        </div>

        <div class="space-y-3 mb-6">
          <div class="flex items-center gap-3">
            <span class="text-green-500 text-xl">üìç</span>
            <div>
              <p class="font-medium text-gray-900">Origem</p>
              <p id="origem-solicitacao" class="text-sm text-gray-600">Rua das Flores, 123 - Centro</p>
            </div>
          </div>
          <div class="flex items-center gap-3">
            <span class="text-red-500 text-xl">üéØ</span>
            <div>
              <p class="font-medium text-gray-900">Destino</p>
              <p id="destino-solicitacao" class="text-sm text-gray-600">Shopping Tapau√° - Zona Sul</p>
            </div>
          </div>
          <div class="flex items-center gap-3">
            <span class="text-blue-500 text-xl">üë§</span>
            <div>
              <p class="font-medium text-gray-900">Passageiro</p>
              <p id="nome-passageiro" class="text-sm text-gray-600">Cliente An√¥nimo</p>
            </div>
          </div>
        </div>

        <div class="flex gap-3 mb-4">
          <button onclick="recusarCorrida()" class="flex-1 bg-red-500 text-white py-4 rounded-xl font-bold hover:bg-red-600 transition-all">
            ‚ùå Recusar
          </button>
          <button onclick="aceitarCorrida()" class="flex-1 bg-green-500 text-white py-4 rounded-xl font-bold hover:bg-green-600 transition-all">
            ‚úÖ Aceitar Corrida
          </button>
        </div>
        
        <div class="text-center">
          <p class="text-sm text-gray-500">Tempo para responder: <span id="tempo-resposta" class="font-bold text-red-500">30s</span></p>
          <div class="w-full bg-red-200 rounded-full h-2 mt-2">
            <div id="barra-tempo" class="bg-red-500 h-2 rounded-full transition-all" style="width: 100%"></div>
          </div>
        </div>
      </div>

      <!-- Corrida Aceita -->
      <div id="corrida-aceita" class="bg-white rounded-2xl shadow-lg p-6 mb-6 hidden">
        <div class="text-center mb-4">
          <div class="bg-blue-100 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
            <svg class="w-10 h-10 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
            </svg>
          </div>
          <h3 class="text-xl font-bold text-gray-900 mb-2">üèçÔ∏è Corrida Aceita!</h3>
          <p class="text-gray-600">V√° at√© o local de origem</p>
          <div class="bg-green-100 p-2 rounded-lg mt-2">
            <p class="text-lg font-bold text-green-700">üí∞ R$ 5,00 (Voc√™ ganha R$ 4,00)</p>
          </div>
        </div>

        <div class="space-y-4 mb-6">
          <div class="bg-blue-50 p-4 rounded-lg">
            <h4 class="font-bold text-blue-700 mb-2">üìç Buscar Passageiro</h4>
            <p id="endereco-origem" class="text-sm text-gray-600">Rua das Flores, 123 - Centro</p>
          </div>
          
          <div class="bg-gray-50 p-4 rounded-lg">
            <h4 class="font-bold text-gray-700 mb-2">üéØ Destino Final</h4>
            <p id="endereco-destino" class="text-sm text-gray-600">Shopping Tapau√° - Zona Sul</p>
          </div>

          <div class="flex gap-3">
            <button onclick="ligarPassageiro()" class="flex-1 bg-green-500 text-white py-3 rounded-lg font-medium hover:bg-green-600 transition-all">
              üìû Ligar
            </button>
            <button onclick="abrirNavegacao()" class="flex-1 bg-blue-500 text-white py-3 rounded-lg font-medium hover:bg-blue-600 transition-all">
              üó∫Ô∏è Navegar
            </button>
          </div>
        </div>

        <div class="space-y-3">
          <button onclick="iniciarCorrida()" id="btn-iniciar-corrida" class="w-full bg-accent text-white py-4 rounded-xl font-bold text-lg hover:bg-accent/90 transition-all">
            üöÄ Iniciar Corrida
          </button>
          <button onclick="finalizarCorrida()" id="btn-finalizar-corrida" class="w-full bg-green-500 text-white py-4 rounded-xl font-bold text-lg hover:bg-green-600 transition-all hidden">
            üèÅ Finalizar Corrida
          </button>
        </div>
      </div>

      <!-- Estat√≠sticas do Dia -->
      <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
        <h3 class="text-lg font-bold text-gray-900 mb-4">üìä Estat√≠sticas de Hoje</h3>
        <div class="grid grid-cols-2 gap-4">
          <div class="text-center p-4 bg-green-50 rounded-lg">
            <p class="text-2xl font-bold text-green-600" id="corridas-hoje">0</p>
            <p class="text-sm text-gray-600">Corridas</p>
          </div>
          <div class="text-center p-4 bg-blue-50 rounded-lg">
            <p class="text-2xl font-bold text-blue-600" id="ganhos-hoje">R$ 0,00</p>
            <p class="text-sm text-gray-600">Ganhos</p>
          </div>
          <div class="text-center p-4 bg-purple-50 rounded-lg">
            <p class="text-2xl font-bold text-purple-600" id="tempo-online">0h 0m</p>
            <p class="text-sm text-gray-600">Online</p>
          </div>
          <div class="text-center p-4 bg-yellow-50 rounded-lg">
            <p class="text-2xl font-bold text-yellow-600" id="avaliacao-media">5.0</p>
            <p class="text-sm text-gray-600">Avalia√ß√£o</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- √Årea Administrativa -->
  <div class="container mx-auto px-4 py-8 max-w-4xl">
    <div class="text-center">
      <button onclick="acessarAdmin()" class="bg-gray-800 text-white px-6 py-3 rounded-lg font-medium hover:bg-gray-900 transition-all">
        üîê √Årea Administrativa
      </button>
    </div>
  </div>

  <!-- Interface Administrativa -->
  <div id="interface-admin" class="container mx-auto px-4 py-8 max-w-6xl hidden">
    <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
      <div class="flex items-center justify-between mb-6">
        <div>
          <h2 class="text-2xl font-bold text-gray-900">üõ†Ô∏è Painel Administrativo</h2>
          <p class="text-gray-600">Gerenciamento de motoristas e corridas</p>
        </div>
        <button onclick="sairAdmin()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-all">
          üö™ Sair
        </button>
      </div>

      <!-- Estat√≠sticas Gerais -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
        <div class="bg-blue-50 p-4 rounded-lg text-center">
          <p class="text-2xl font-bold text-blue-600" id="total-motoristas">0</p>
          <p class="text-sm text-gray-600">Motoristas Ativos</p>
        </div>
        <div class="bg-green-50 p-4 rounded-lg text-center">
          <p class="text-2xl font-bold text-green-600" id="receita-admin">R$ 0,00</p>
          <p class="text-sm text-gray-600">Receita do App</p>
        </div>
        <div class="bg-yellow-50 p-4 rounded-lg text-center">
          <p class="text-2xl font-bold text-yellow-600" id="corridas-total">0</p>
          <p class="text-sm text-gray-600">Corridas Hoje</p>
        </div>
        <div class="bg-purple-50 p-4 rounded-lg text-center">
          <p class="text-2xl font-bold text-purple-600" id="motoristas-online">0</p>
          <p class="text-sm text-gray-600">Online Agora</p>
        </div>
      </div>

      <!-- Lista de Motoristas -->
      <div class="bg-gray-50 rounded-xl p-6">
        <h3 class="text-lg font-bold text-gray-900 mb-4">üë• Motoristas Cadastrados</h3>
        <div class="space-y-4" id="lista-motoristas">
          <p class="text-gray-500 text-center py-8">Nenhum motorista cadastrado ainda</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Modals -->
  <!-- Modal de Login Admin -->
  <div id="modal-login-admin" class="fixed inset-0 bg-black/50 flex items-center justify-center p-4 hidden z-50">
    <div class="bg-white rounded-2xl p-6 w-full max-w-sm">
      <div class="text-center mb-6">
        <div class="bg-gray-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
          <svg class="w-8 h-8 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
          </svg>
        </div>
        <h3 class="text-xl font-bold text-gray-900 mb-2">Acesso Restrito</h3>
        <p class="text-gray-600">Digite a senha de administrador</p>
      </div>

      <div class="mb-6">
        <input type="password" id="senha-admin" placeholder="Digite a senha" 
               class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent">
        <p id="erro-senha" class="text-red-500 text-sm mt-2 hidden">Senha incorreta!</p>
      </div>

      <div class="flex gap-3">
        <button onclick="cancelarLoginAdmin()" class="flex-1 bg-gray-500 text-white py-3 rounded-lg font-medium hover:bg-gray-600 transition-all">
          Cancelar
        </button>
        <button onclick="validarSenhaAdmin()" class="flex-1 bg-primary text-white py-3 rounded-lg font-medium hover:bg-gray-800 transition-all">
          Entrar
        </button>
      </div>
    </div>
  </div>

  <!-- Modal de Avalia√ß√£o -->
  <div id="modal-avaliacao" class="fixed inset-0 bg-black/50 flex items-center justify-center p-4 hidden z-50">
    <div class="bg-white rounded-2xl p-6 w-full max-w-sm">
      <div class="text-center mb-6">
        <div class="bg-green-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
          <svg class="w-8 h-8 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
          </svg>
        </div>
        <h3 class="text-xl font-bold text-gray-900 mb-2">Corrida Finalizada!</h3>
        <p class="text-gray-600">Como foi sua experi√™ncia?</p>
        <div class="bg-green-100 p-2 rounded-lg mt-2">
          <p class="text-lg font-bold text-green-700">üí∞ R$ 5,00</p>
        </div>
      </div>

      <div class="mb-6">
        <div class="flex justify-center gap-2 mb-4">
          <button onclick="avaliar(1)" class="text-3xl hover:scale-110 transition-transform">‚≠ê</button>
          <button onclick="avaliar(2)" class="text-3xl hover:scale-110 transition-transform">‚≠ê</button>
          <button onclick="avaliar(3)" class="text-3xl hover:scale-110 transition-transform">‚≠ê</button>
          <button onclick="avaliar(4)" class="text-3xl hover:scale-110 transition-transform">‚≠ê</button>
          <button onclick="avaliar(5)" class="text-3xl hover:scale-110 transition-transform">‚≠ê</button>
        </div>
        <textarea placeholder="Deixe um coment√°rio (opcional)" 
                  class="w-full p-3 border border-gray-300 rounded-lg resize-none" rows="3"></textarea>
      </div>

      <button onclick="enviarAvaliacao()" class="w-full bg-secondary text-white py-3 rounded-lg font-medium hover:bg-secondary/90 transition-all">
        Enviar Avalia√ß√£o
      </button>
    </div>
  </div>

  <script>
    // Configura√ß√£o do Firebase
    const firebaseConfig = {
      ap// Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyAJk8-W80iJyGHoJBeNZDo5k9wmh8HRPrQ",
  authDomain: "mototaxi-tapaua.firebaseapp.com",
  projectId: "mototaxi-tapaua",
  storageBucket: "mototaxi-tapaua.firebasestorage.app",
  messagingSenderId: "629986832248",
  appId: "1:629986832248:web:fd044f24cc51aa018ba28d",
  measurementId: "G-1S6PYNHWN5"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
    };

    // Inicializar Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // Monitorar conex√£o com Firebase
    database.ref('.info/connected').on('value', (snapshot) => {
      const statusElement = document.getElementById('status-dispositivo');
      if (snapshot.val() === true) {
        statusElement.textContent = 'üü¢ Online';
        statusElement.className = 'text-xs text-green-600';
        console.log('Conectado ao Firebase');
      } else {
        statusElement.textContent = 'üî¥ Offline';
        statusElement.className = 'text-xs text-red-600';
        console.log('Desconectado do Firebase');
      }
    });

    // Estado global da aplica√ß√£o
    let interfaceAtual = 'passageiro';
    let statusMotorista = 'offline';
    let corridaAtiva = null;
    let avaliacaoSelecionada = 0;
    let intervalos = {};
    let motoristaCadastrado = false;
    let motoristaAtual = null;
    let corridasAtivas = [];
    let proximoIdCorrida = 1;
    let deviceId = 'device_' + Math.random().toString(36).substr(2, 9);

    // Dados dos motoristas cadastrados (agora sincronizados com Firebase)
    let motoristas = [];

    // Sistema de corridas em tempo real (agora no Firebase)
    let sistemaCorridas = {
      solicitacoes: [],
      corridasEmAndamento: [],
      receitaTotal: 0,
      corridasFinalizadas: []
    };

    // === FUN√á√ïES DO FIREBASE ===
    
    // Sincronizar motoristas em tempo real
    function iniciarSincronizacaoMotoristas() {
      database.ref('motoristas').on('value', (snapshot) => {
        const data = snapshot.val();
        motoristas = data ? Object.values(data) : [];
        atualizarEstatisticasAdmin();
        atualizarListaMotoristas();
        console.log('Motoristas sincronizados:', motoristas.length);
      });
    }

    // Sincronizar corridas em tempo real
    function iniciarSincronizacaoCorridas() {
      // Escutar novas solicita√ß√µes
      database.ref('corridas/solicitacoes').on('child_added', (snapshot) => {
        const corrida = snapshot.val();
        if (corrida && corrida.status === 'procurando') {
          console.log('Nova corrida detectada:', corrida);
          
          // Se √© motorista online, mostrar notifica√ß√£o
          if (interfaceAtual === 'motorista' && statusMotorista === 'online' && motoristaAtual) {
            mostrarSolicitacaoParaMotorista(corrida);
          }
          
          // Atualizar notifica√ß√µes
          atualizarNotificacoes();
        }
      });

      // Escutar mudan√ßas de status das corridas
      database.ref('corridas/solicitacoes').on('child_changed', (snapshot) => {
        const corrida = snapshot.val();
        console.log('Status da corrida alterado:', corrida);
        
        // Se a corrida foi aceita e √© a corrida ativa do passageiro
        if (corrida.status === 'aceita' && corridaAtiva && corridaAtiva.id === corrida.id) {
          // Buscar dados do motorista
          database.ref(`motoristas/${corrida.motoristaId}`).once('value', (motoristaSnapshot) => {
            const motorista = motoristaSnapshot.val();
            if (motorista) {
              corridaAceita(motorista);
            }
          });
        }
      });

      // Escutar corridas finalizadas
      database.ref('corridas/finalizadas').on('child_added', (snapshot) => {
        const corrida = snapshot.val();
        sistemaCorridas.receitaTotal += 1.00; // Taxa do app
        atualizarEstatisticasAdmin();
      });
    }

    // Salvar motorista no Firebase
    function salvarMotoristaFirebase(motorista) {
      return database.ref(`motoristas/${motorista.id}`).set(motorista);
    }

    // Atualizar status online do motorista
    function atualizarStatusMotorista(motoristaId, online) {
      return database.ref(`motoristas/${motoristaId}/online`).set(online);
    }

    // Criar nova solicita√ß√£o de corrida no Firebase
    function criarSolicitacaoFirebase(corrida) {
      return database.ref(`corridas/solicitacoes/${corrida.id}`).set(corrida);
    }

    // Aceitar corrida no Firebase
    function aceitarCorridaFirebase(corridaId, motoristaId) {
      const updates = {};
      updates[`corridas/solicitacoes/${corridaId}/status`] = 'aceita';
      updates[`corridas/solicitacoes/${corridaId}/motoristaId`] = motoristaId;
      updates[`corridas/solicitacoes/${corridaId}/dataAceite`] = firebase.database.ServerValue.TIMESTAMP;
      
      return database.ref().update(updates);
    }

    // Finalizar corrida no Firebase
    function finalizarCorridaFirebase(corrida) {
      const updates = {};
      
      // Remover da lista de solicita√ß√µes
      updates[`corridas/solicitacoes/${corrida.id}`] = null;
      
      // Adicionar √†s finalizadas
      updates[`corridas/finalizadas/${corrida.id}`] = {
        ...corrida,
        status: 'finalizada',
        dataFinalizacao: firebase.database.ServerValue.TIMESTAMP
      };
      
      // Atualizar estat√≠sticas do motorista
      updates[`motoristas/${corrida.motoristaId}/corridasHoje`] = firebase.database.ServerValue.increment(1);
      updates[`motoristas/${corrida.motoristaId}/ganhosHoje`] = firebase.database.ServerValue.increment(4.00);
      
      return database.ref().update(updates);
    }

    // Inicializa√ß√£o
    document.addEventListener('DOMContentLoaded', function() {
      formatarCPF();
      
      // Iniciar sincroniza√ß√£o com Firebase
      iniciarSincronizacaoMotoristas();
      iniciarSincronizacaoCorridas();
      
      // Aguardar um pouco para carregar dados do Firebase
      setTimeout(() => {
        atualizarEstatisticasAdmin();
        
        // Se n√£o h√° motoristas, criar um de exemplo
        if (motoristas.length === 0) {
          const motoristaExemplo = {
            id: 1,
            nome: 'Jo√£o Silva',
            cpf: '123.456.789-00',
            telefone: '(97) 99999-9999',
            placa: 'ABC-1234',
            online: false,
            corridasHoje: 0,
            ganhosHoje: 0,
            deviceId: 'exemplo_device'
          };
          
          salvarMotoristaFirebase(motoristaExemplo).then(() => {
            console.log('Motorista de exemplo criado');
          });
        }
      }, 2000);
    });

    // Formata√ß√£o de CPF
    function formatarCPF() {
      const cpfInput = document.getElementById('cpf-motorista');
      if (cpfInput) {
        cpfInput.addEventListener('input', function(e) {
          let value = e.target.value.replace(/\D/g, '');
          value = value.replace(/(\d{3})(\d)/, '$1.$2');
          value = value.replace(/(\d{3})(\d)/, '$1.$2');
          value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
          e.target.value = value;
        });
      }
    }

    // Valida√ß√£o de CPF
    function validarCPF(cpf) {
      cpf = cpf.replace(/[^\d]+/g, '');
      if (cpf.length !== 11 || /^(\d)\1{10}$/.test(cpf)) return false;
      
      let soma = 0;
      for (let i = 0; i < 9; i++) {
        soma += parseInt(cpf.charAt(i)) * (10 - i);
      }
      let resto = 11 - (soma % 11);
      if (resto === 10 || resto === 11) resto = 0;
      if (resto !== parseInt(cpf.charAt(9))) return false;
      
      soma = 0;
      for (let i = 0; i < 10; i++) {
        soma += parseInt(cpf.charAt(i)) * (11 - i);
      }
      resto = 11 - (soma % 11);
      if (resto === 10 || resto === 11) resto = 0;
      return resto === parseInt(cpf.charAt(10));
    }

    // Fun√ß√µes de Interface
    function mostrarInterface(tipo) {
      interfaceAtual = tipo;
      
      // Esconder todas as interfaces
      document.getElementById('interface-passageiro').classList.add('hidden');
      document.getElementById('interface-motorista').classList.add('hidden');
      document.getElementById('interface-admin').classList.add('hidden');
      
      // Resetar bot√µes
      document.getElementById('btn-passageiro').classList.remove('bg-primary', 'text-white');
      document.getElementById('btn-passageiro').classList.add('border', 'border-gray-300', 'text-gray-700');
      document.getElementById('btn-motorista').classList.remove('bg-primary', 'text-white');
      document.getElementById('btn-motorista').classList.add('border', 'border-gray-300', 'text-gray-700');
      
      if (tipo === 'passageiro') {
        document.getElementById('interface-passageiro').classList.remove('hidden');
        document.getElementById('btn-passageiro').classList.add('bg-primary', 'text-white');
        document.getElementById('btn-passageiro').classList.remove('border', 'border-gray-300', 'text-gray-700');
      } else {
        document.getElementById('interface-motorista').classList.remove('hidden');
        document.getElementById('btn-motorista').classList.add('bg-primary', 'text-white');
        document.getElementById('btn-motorista').classList.remove('border', 'border-gray-300', 'text-gray-700');
      }
    }

    // === FUN√á√ïES DO PASSAGEIRO ===
    function obterLocalizacao(campo) {
      const input = document.getElementById(campo);
      input.value = 'Obtendo localiza√ß√£o...';
      
      setTimeout(() => {
        const locais = [
          'Rua das Flores, 123 - Centro, Tapau√°',
          'Av. Principal, 456 - Centro, Tapau√°',
          'Rua do Com√©rcio, 789 - Centro, Tapau√°'
        ];
        input.value = locais[Math.floor(Math.random() * locais.length)];
      }, 2000);
    }

    function solicitarCorrida() {
      const origem = document.getElementById('origem').value;
      const destino = document.getElementById('destino').value;
      
      if (!origem || !destino) {
        alert('Por favor, preencha origem e destino');
        return;
      }

      // Verificar se h√° motoristas online
      const motoristasOnline = motoristas.filter(m => m.online);
      if (motoristasOnline.length === 0) {
        alert('Nenhum motorista dispon√≠vel no momento. Tente novamente em alguns minutos.');
        return;
      }
      
      // Criar nova solicita√ß√£o de corrida
      const novaCorrida = {
        id: Date.now(), // Usar timestamp como ID √∫nico
        origem: origem,
        destino: destino,
        passageiro: 'Cliente',
        passageiroDevice: deviceId,
        valor: 5.00,
        status: 'procurando',
        timestamp: firebase.database.ServerValue.TIMESTAMP,
        motoristaId: null
      };
      
      corridaAtiva = novaCorrida;
      
      // Mostrar interface de busca
      document.getElementById('status-corrida').classList.remove('hidden');
      document.getElementById('btn-solicitar').disabled = true;
      
      // Salvar no Firebase - isso automaticamente notificar√° todos os motoristas online
      criarSolicitacaoFirebase(novaCorrida).then(() => {
        console.log('Corrida salva no Firebase:', novaCorrida);
        
        // Iniciar contador de busca
        iniciarContadorBusca();
        
        // Timeout para cancelar se ningu√©m aceitar
        setTimeout(() => {
          if (corridaAtiva && corridaAtiva.status === 'procurando') {
            cancelarCorridaPorTimeout();
          }
        }, 60000); // 60 segundos
        
      }).catch((error) => {
        console.error('Erro ao salvar corrida:', error);
        alert('Erro ao solicitar corrida. Tente novamente.');
        resetarInterfacePassageiro();
      });
    }

    function enviarSolicitacaoParaMotoristas(corrida) {
      // Simular envio para todos os motoristas online
      const motoristasOnline = motoristas.filter(m => m.online);
      
      motoristasOnline.forEach(motorista => {
        // Se o motorista est√° na interface, mostrar a solicita√ß√£o
        if (interfaceAtual === 'motorista' && motoristaAtual && motoristaAtual.id === motorista.id) {
          mostrarSolicitacaoParaMotorista(corrida);
        }
      });
      
      console.log(`Solicita√ß√£o enviada para ${motoristasOnline.length} motoristas`);
    }

    function iniciarContadorBusca() {
      let tempo = 0;
      intervalos.busca = setInterval(() => {
        document.getElementById('tempo-busca').textContent = tempo;
        tempo++;
        
        // Timeout ap√≥s 60 segundos
        if (tempo > 60) {
          clearInterval(intervalos.busca);
          cancelarCorridaPorTimeout();
        }
      }, 1000);
    }

    function cancelarCorridaPorTimeout() {
      alert('N√£o foi poss√≠vel encontrar um motorista. Tente novamente.');
      resetarInterfacePassageiro();
    }

    function corridaAceita(motorista) {
      clearInterval(intervalos.busca);
      
      // Atualizar status da corrida
      if (corridaAtiva) {
        corridaAtiva.status = 'aceita';
        corridaAtiva.motoristaId = motorista.id;
        corridaAtiva.motorista = motorista;
      }
      
      // Atualizar interface
      document.getElementById('status-titulo').textContent = 'Motorista encontrado!';
      document.getElementById('status-descricao').textContent = `${motorista.nome} est√° a caminho`;
      document.getElementById('nome-motorista').textContent = motorista.nome;
      document.getElementById('veiculo-motorista').textContent = `${motorista.placa}`;
      
      document.getElementById('status-icon').innerHTML = `
        <svg class="w-10 h-10 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
        </svg>
      `;
      
      document.getElementById('info-motorista').classList.remove('hidden');
      document.getElementById('contador-busca').classList.add('hidden');
      
      iniciarContadorChegada();
    }

    function iniciarContadorChegada() {
      let tempo = 300; // 5 minutos
      let progresso = 0;
      
      intervalos.chegada = setInterval(() => {
        const minutos = Math.floor(tempo / 60);
        const segundos = tempo % 60;
        document.getElementById('tempo-chegada').textContent = `${minutos}:${segundos.toString().padStart(2, '0')}`;
        
        progresso = ((300 - tempo) / 300) * 100;
        document.getElementById('progresso-chegada').style.width = progresso + '%';
        
        if (tempo <= 0) {
          clearInterval(intervalos.chegada);
          motoristasChegou();
        }
        tempo--;
      }, 1000);
    }

    function motoristasChegou() {
      document.getElementById('info-motorista').classList.add('hidden');
      document.getElementById('corrida-em-andamento').classList.remove('hidden');
      
      if (corridaAtiva) {
        corridaAtiva.status = 'em_andamento';
      }
    }

    function ligarMotorista() {
      if (corridaAtiva && corridaAtiva.motorista) {
        alert(`Ligando para ${corridaAtiva.motorista.nome}...\nüìû ${corridaAtiva.motorista.telefone}`);
      }
    }

    function enviarMensagem() {
      alert('Mensagem enviada: "Estou aguardando no local combinado"');
    }

    function abrirChat() {
      alert('Chat com o motorista (funcionalidade em desenvolvimento)');
    }

    function cancelarCorrida() {
      if (confirm('Tem certeza que deseja cancelar a corrida?')) {
        if (corridaAtiva) {
          // Remover da lista de solicita√ß√µes
          sistemaCorridas.solicitacoes = sistemaCorridas.solicitacoes.filter(c => c.id !== corridaAtiva.id);
        }
        
        resetarInterfacePassageiro();
        clearInterval(intervalos.busca);
        clearInterval(intervalos.chegada);
      }
    }

    function resetarInterfacePassageiro() {
      corridaAtiva = null;
      document.getElementById('status-corrida').classList.add('hidden');
      document.getElementById('btn-solicitar').disabled = false;
      document.getElementById('origem').value = '';
      document.getElementById('destino').value = '';
    }

    // === FUN√á√ïES DO MOTORISTA ===
    function cadastrarMotorista() {
      const nome = document.getElementById('nome-motorista').value;
      const cpf = document.getElementById('cpf-motorista').value;
      const telefone = document.getElementById('telefone-motorista').value;
      const placa = document.getElementById('placa-motorista').value;
      const cpfErro = document.getElementById('cpf-erro');

      if (!nome || !cpf || !telefone || !placa) {
        alert('Por favor, preencha todos os campos');
        return;
      }

      if (!validarCPF(cpf)) {
        cpfErro.classList.remove('hidden');
        return;
      }

      cpfErro.classList.add('hidden');
      
      // Criar novo motorista
      const novoMotorista = {
        id: Date.now(), // ID √∫nico baseado em timestamp
        nome: nome,
        cpf: cpf,
        telefone: telefone,
        placa: placa,
        online: false,
        corridasHoje: 0,
        ganhosHoje: 0,
        deviceId: deviceId,
        ultimoPagamento: firebase.database.ServerValue.TIMESTAMP,
        diasAtraso: 0
      };

      // Salvar no Firebase
      salvarMotoristaFirebase(novoMotorista).then(() => {
        motoristaAtual = novoMotorista;
        motoristaCadastrado = true;
        
        document.getElementById('cadastro-motorista').classList.add('hidden');
        document.getElementById('painel-motorista').classList.remove('hidden');
        
        alert('Cadastro realizado com sucesso! Agora voc√™ pode ficar online para receber corridas.');
        console.log('Motorista cadastrado:', novoMotorista);
        
      }).catch((error) => {
        console.error('Erro ao cadastrar motorista:', error);
        alert('Erro ao realizar cadastro. Tente novamente.');
      });
    }

    function alternarStatus() {
      if (!motoristaCadastrado) {
        alert('Voc√™ precisa se cadastrar primeiro!');
        return;
      }

      const btn = document.getElementById('btn-status');
      const icon = document.getElementById('status-motorista-icon');
      const texto = document.getElementById('status-motorista-texto');
      
      if (statusMotorista === 'offline') {
        statusMotorista = 'online';
        
        // Atualizar no Firebase
        atualizarStatusMotorista(motoristaAtual.id, true).then(() => {
          console.log('Status atualizado para online no Firebase');
          
          btn.textContent = 'üî¥ Ficar Offline';
          btn.classList.remove('bg-green-500', 'hover:bg-green-600');
          btn.classList.add('bg-red-500', 'hover:bg-red-600');
          
          icon.classList.remove('bg-red-100');
          icon.classList.add('bg-green-100');
          icon.innerHTML = `
            <svg class="w-10 h-10 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
            </svg>
          `;
          
          texto.textContent = 'Online - Aguardando corridas';
          
          // Verificar se h√° solicita√ß√µes pendentes
          verificarSolicitacoesPendentes();
          
        }).catch((error) => {
          console.error('Erro ao atualizar status:', error);
          alert('Erro ao ficar online. Tente novamente.');
        });
        
      } else {
        statusMotorista = 'offline';
        
        // Atualizar no Firebase
        atualizarStatusMotorista(motoristaAtual.id, false).then(() => {
          console.log('Status atualizado para offline no Firebase');
          
          btn.textContent = 'üü¢ Ficar Online';
          btn.classList.remove('bg-red-500', 'hover:bg-red-600');
          btn.classList.add('bg-green-500', 'hover:bg-green-600');
          
          icon.classList.remove('bg-green-100');
          icon.classList.add('bg-red-100');
          icon.innerHTML = `
            <svg class="w-10 h-10 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728L5.636 5.636m12.728 12.728L18.364 5.636M5.636 18.364l12.728-12.728"/>
            </svg>
          `;
          
          texto.textContent = 'Offline';
          document.getElementById('nova-solicitacao').classList.add('hidden');
          
        }).catch((error) => {
          console.error('Erro ao atualizar status:', error);
          alert('Erro ao ficar offline. Tente novamente.');
        });
      }
    }

    function verificarSolicitacoesPendentes() {
      const solicitacoesPendentes = sistemaCorridas.solicitacoes.filter(s => s.status === 'procurando');
      if (solicitacoesPendentes.length > 0) {
        mostrarSolicitacaoParaMotorista(solicitacoesPendentes[0]);
      }
    }

    function mostrarSolicitacaoParaMotorista(corrida) {
      if (statusMotorista !== 'online') return;
      
      // Verificar se j√° est√° exibindo uma solicita√ß√£o
      if (!document.getElementById('nova-solicitacao').classList.contains('hidden')) {
        return; // J√° h√° uma solicita√ß√£o sendo exibida
      }
      
      document.getElementById('origem-solicitacao').textContent = corrida.origem;
      document.getElementById('destino-solicitacao').textContent = corrida.destino;
      document.getElementById('nome-passageiro').textContent = corrida.passageiro;
      
      // Armazenar o ID da corrida no elemento
      document.getElementById('nova-solicitacao').dataset.corridaId = corrida.id;
      document.getElementById('nova-solicitacao').classList.remove('hidden');
      
      // Tocar som de notifica√ß√£o (se suportado)
      try {
        const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUarm7blmGgU7k9n1unEiBC13yO/eizEIHWq+8+OWT');
        audio.play().catch(() => {}); // Ignorar erro se n√£o conseguir tocar
      } catch (e) {}
      
      // Iniciar countdown
      let tempoRestante = 30;
      document.getElementById('tempo-resposta').textContent = tempoRestante + 's';
      
      intervalos.resposta = setInterval(() => {
        tempoRestante--;
        document.getElementById('tempo-resposta').textContent = tempoRestante + 's';
        
        const porcentagem = (tempoRestante / 30) * 100;
        document.getElementById('barra-tempo').style.width = porcentagem + '%';
        
        if (tempoRestante <= 0) {
          clearInterval(intervalos.resposta);
          recusarCorrida();
        }
      }, 1000);
      
      console.log('Solicita√ß√£o exibida para motorista:', corrida);
    }

    function aceitarCorrida() {
      clearInterval(intervalos.resposta);
      
      // Buscar a corrida atual sendo exibida
      const corridaId = document.getElementById('nova-solicitacao').dataset.corridaId;
      if (!corridaId) return;
      
      // Aceitar a corrida no Firebase
      aceitarCorridaFirebase(corridaId, motoristaAtual.id).then(() => {
        console.log('Corrida aceita no Firebase:', corridaId);
        
        // Atualizar interface local
        document.getElementById('nova-solicitacao').classList.add('hidden');
        document.getElementById('corrida-aceita').classList.remove('hidden');
        
        // Buscar dados atualizados da corrida
        database.ref(`corridas/solicitacoes/${corridaId}`).once('value', (snapshot) => {
          const corrida = snapshot.val();
          if (corrida) {
            document.getElementById('endereco-origem').textContent = corrida.origem;
            document.getElementById('endereco-destino').textContent = corrida.destino;
          }
        });
        
      }).catch((error) => {
        console.error('Erro ao aceitar corrida:', error);
        alert('Erro ao aceitar corrida. Tente novamente.');
        
        // Reexibir a solicita√ß√£o
        document.getElementById('nova-solicitacao').classList.remove('hidden');
      });
    }

    function recusarCorrida() {
      clearInterval(intervalos.resposta);
      document.getElementById('nova-solicitacao').classList.add('hidden');
      
      // Verificar outras solicita√ß√µes
      setTimeout(() => {
        if (statusMotorista === 'online') {
          verificarSolicitacoesPendentes();
        }
      }, 5000);
    }

    function iniciarCorrida() {
      document.getElementById('btn-iniciar-corrida').classList.add('hidden');
      document.getElementById('btn-finalizar-corrida').classList.remove('hidden');
      
      alert('Corrida iniciada! Leve o passageiro ao destino com seguran√ßa.');
    }

    function finalizarCorrida() {
      if (!confirm('Confirma que chegou ao destino e deseja finalizar a corrida?')) {
        return;
      }
      
      // Buscar a corrida atual do motorista
      database.ref('corridas/solicitacoes').orderByChild('motoristaId').equalTo(motoristaAtual.id).once('value', (snapshot) => {
        const corridas = snapshot.val();
        if (!corridas) {
          alert('Nenhuma corrida ativa encontrada.');
          return;
        }
        
        // Pegar a primeira corrida encontrada
        const corridaId = Object.keys(corridas)[0];
        const corrida = corridas[corridaId];
        
        // Finalizar no Firebase
        finalizarCorridaFirebase(corrida).then(() => {
          console.log('Corrida finalizada no Firebase:', corrida);
          
          // Calcular valores
          const valorTotal = 5.00;
          const valorMotorista = 4.00;
          const valorApp = 1.00;
          
          // Atualizar interface local
          document.getElementById('corrida-aceita').classList.add('hidden');
          
          // Atualizar estat√≠sticas locais (ser√£o sincronizadas pelo Firebase)
          setTimeout(() => {
            // Buscar dados atualizados do motorista
            database.ref(`motoristas/${motoristaAtual.id}`).once('value', (motoristaSnapshot) => {
              const motoristaAtualizado = motoristaSnapshot.val();
              if (motoristaAtualizado) {
                document.getElementById('corridas-hoje').textContent = motoristaAtualizado.corridasHoje || 0;
                document.getElementById('ganhos-hoje').textContent = `R$ ${(motoristaAtualizado.ganhosHoje || 0).toFixed(2)}`;
              }
            });
          }, 1000);
          
          alert(`Corrida finalizada!\nVoc√™ ganhou: R$ ${valorMotorista.toFixed(2)}\nTaxa do app: R$ ${valorApp.toFixed(2)}`);
          
        }).catch((error) => {
          console.error('Erro ao finalizar corrida:', error);
          alert('Erro ao finalizar corrida. Tente novamente.');
        });
      });
    }

    function ligarPassageiro() {
      alert('Ligando para o passageiro...\nüìû (97) 98888-8888');
    }

    function abrirNavegacao() {
      const corridaEmAndamento = sistemaCorridas.corridasEmAndamento.find(c => c.motoristaId === motoristaAtual.id);
      if (corridaEmAndamento) {
        alert(`Abrindo navega√ß√£o para:\n${corridaEmAndamento.origem}\n\nDestino final:\n${corridaEmAndamento.destino}`);
      }
    }

    function copiarPix() {
      const codigoPix = document.getElementById('codigo-pix').textContent;
      navigator.clipboard.writeText(codigoPix).then(() => {
        alert('C√≥digo PIX copiado para a √°rea de transfer√™ncia!');
      });
    }

    function confirmarPagamento() {
      if (confirm('Confirma que o pagamento foi realizado?')) {
        document.getElementById('status-pagamento').innerHTML = 
          '<span class="text-green-500">‚úÖ Pagamento em dia</span>';
        alert('Pagamento confirmado! Obrigado.');
      }
    }

    // === FUN√á√ïES ADMINISTRATIVAS ===
    function acessarAdmin() {
      document.getElementById('modal-login-admin').classList.remove('hidden');
    }

    function validarSenhaAdmin() {
      const senha = document.getElementById('senha-admin').value;
      const erroSenha = document.getElementById('erro-senha');
      
      if (senha === '@Zxcasdqwe123') {
        document.getElementById('modal-login-admin').classList.add('hidden');
        document.getElementById('interface-admin').classList.remove('hidden');
        document.getElementById('interface-passageiro').classList.add('hidden');
        document.getElementById('interface-motorista').classList.add('hidden');
        document.getElementById('senha-admin').value = '';
        erroSenha.classList.add('hidden');
        atualizarListaMotoristas();
        atualizarEstatisticasAdmin();
      } else {
        erroSenha.classList.remove('hidden');
      }
    }

    function cancelarLoginAdmin() {
      document.getElementById('modal-login-admin').classList.add('hidden');
      document.getElementById('senha-admin').value = '';
      document.getElementById('erro-senha').classList.add('hidden');
    }

    function sairAdmin() {
      document.getElementById('interface-admin').classList.add('hidden');
      mostrarInterface('passageiro');
    }

    function atualizarEstatisticasAdmin() {
      const totalMotoristas = motoristas.length;
      const motoristasOnline = motoristas.filter(m => m.online).length;
      const corridasHoje = sistemaCorridas.corridasFinalizadas.length;
      const receitaApp = sistemaCorridas.receitaTotal;
      
      document.getElementById('total-motoristas').textContent = totalMotoristas;
      document.getElementById('motoristas-online').textContent = motoristasOnline;
      document.getElementById('corridas-total').textContent = corridasHoje;
      document.getElementById('receita-admin').textContent = `R$ ${receitaApp.toFixed(2)}`;
    }

    function atualizarListaMotoristas() {
      const lista = document.getElementById('lista-motoristas');
      
      if (motoristas.length === 0) {
        lista.innerHTML = '<p class="text-gray-500 text-center py-8">Nenhum motorista cadastrado ainda</p>';
        return;
      }
      
      lista.innerHTML = '';

      motoristas.forEach(motorista => {
        const div = document.createElement('div');
        div.className = 'bg-white p-4 rounded-lg border';
        
        const statusOnline = motorista.online 
          ? '<span class="text-green-500">üü¢ Online</span>'
          : '<span class="text-gray-500">‚ö´ Offline</span>';

        div.innerHTML = `
          <div class="flex items-center justify-between">
            <div class="flex-1">
              <h4 class="font-bold text-gray-900">${motorista.nome}</h4>
              <p class="text-sm text-gray-600">CPF: ${motorista.cpf}</p>
              <p class="text-sm text-gray-600">Telefone: ${motorista.telefone}</p>
              <p class="text-sm text-gray-600">Placa: ${motorista.placa}</p>
              <div class="flex gap-4 mt-2">
                <p class="text-sm">${statusOnline}</p>
                <p class="text-sm text-blue-600">Corridas hoje: ${motorista.corridasHoje}</p>
                <p class="text-sm text-green-600">Ganhos: R$ ${motorista.ganhosHoje.toFixed(2)}</p>
              </div>
            </div>
            <div class="flex flex-col gap-2">
              <button onclick="removerMotorista(${motorista.id})" 
                      class="bg-red-500 text-white px-3 py-2 rounded text-sm hover:bg-red-600 transition-all">
                üóëÔ∏è Remover
              </button>
            </div>
          </div>
        `;
        
        lista.appendChild(div);
      });
    }

    function removerMotorista(id) {
      const motorista = motoristas.find(m => m.id === id);
      if (confirm(`Tem certeza que deseja remover ${motorista.nome} da plataforma?`)) {
        motoristas = motoristas.filter(m => m.id !== id);
        atualizarListaMotoristas();
        atualizarEstatisticasAdmin();
        alert('Motorista removido com sucesso!');
      }
    }

    // === FUN√á√ïES DE AVALIA√á√ÉO ===
    function avaliar(estrelas) {
      avaliacaoSelecionada = estrelas;
      const botoes = document.querySelectorAll('#modal-avaliacao button[onclick^="avaliar"]');
      
      botoes.forEach((btn, index) => {
        if (index < estrelas) {
          btn.style.filter = 'none';
          btn.style.opacity = '1';
        } else {
          btn.style.filter = 'grayscale(100%)';
          btn.style.opacity = '0.3';
        }
      });
    }

    function enviarAvaliacao() {
      if (avaliacaoSelecionada === 0) {
        alert('Por favor, selecione uma avalia√ß√£o');
        return;
      }
      
      document.getElementById('modal-avaliacao').classList.add('hidden');
      

      
      resetarInterfacePassageiro();
      alert(`Obrigado pela avalia√ß√£o de ${avaliacaoSelecionada} estrelas!`);
      
      avaliacaoSelecionada = 0;
    }

    // Event Listeners
    document.getElementById('senha-admin').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        validarSenhaAdmin();
      }
    });

    // Atualizar notifica√ß√µes
    function atualizarNotificacoes() {
      const badge = document.getElementById('badge-count');
      
      // Buscar solicita√ß√µes pendentes no Firebase
      database.ref('corridas/solicitacoes').orderByChild('status').equalTo('procurando').once('value', (snapshot) => {
        const solicitacoes = snapshot.val();
        const count = solicitacoes ? Object.keys(solicitacoes).length : 0;
        
        if (count > 0) {
          badge.textContent = count;
          badge.classList.remove('hidden');
        } else {
          badge.classList.add('hidden');
        }
      });
    }

    // Atualizar notifica√ß√µes a cada segundo
    setInterval(atualizarNotificacoes, 1000);
  </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'959d04938464c618',t:'MTc1MTYxNTI4MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
